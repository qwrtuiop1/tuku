import{_ as oe}from"./_plugin-vue_export-helper-BwE83l92.js";/* empty css                    */import{b as ne,j as Fe,k as se,J as Ce,c as ie,E as U,X as ae,A as be,w as Se,aj as Pe,ak as xe,al as Le,am as Te,an as Ee,ao as De,ap as Ue,$ as fe,a0 as ze,s as pe,Y as Me,a9 as Ve,W as Re}from"./element-CCVRQ6po.js";import{f as re,c as te,h as H,d as me,e as _e}from"./helpers-Bt27ni5u.js";import{a as V}from"./index-z_UOtP8j.js";import{ax as Be,r as d,c as R,y as ue,z as F,A as m,B as e,L as j,R as t,aB as Ae,J as r,u,P as C,E as le,O as z,Q as Ie,a6 as qe,I as q,w as Ne,j as ge,U as ye,D as ve}from"./vendor-BcB6VvZI.js";/* empty css               *//* empty css                  *//* empty css                 *//* empty css                        *//* empty css                  */const he=Be("files",()=>{const y=d([]),N=d([]),f=d(null),S=d(!1),h=d([]),v=d([]),L=d("grid"),k=d(""),P=d("all"),g=d({page:1,limit:20,total:0,pages:0}),w=R(()=>{let s=y.value;if(P.value!=="all"&&(s=s.filter(a=>a.file_type===P.value)),k.value){const a=k.value.toLowerCase();s=s.filter($=>$.original_name.toLowerCase().includes(a)||$.filename.toLowerCase().includes(a))}return s}),x=R(()=>y.value.filter(s=>v.value.includes(s.id))),M=R(()=>x.value.reduce((s,a)=>s+a.file_size,0)),n=async(s=1)=>{S.value=!0;try{const a={page:s,limit:g.value.limit};f.value&&(a.folder_id=f.value),P.value!=="all"&&(a.file_type=P.value),k.value&&(a.search=k.value);const $=await V.get("/files",{params:a});y.value=$.data.files,g.value=$.data.pagination}catch{}finally{S.value=!1}},b=async()=>{try{const s={};f.value&&(s.parent_id=f.value);const a=await V.get("/folders",{params:s});N.value=a.data.folders}catch{}},p=async s=>{try{return(await V.get(`/folders/path/${s}`)).data.path}catch{return[]}},T=async s=>{const a=Array.from(s).map($=>B($));await Promise.all(a),await n()},B=async s=>{var $,ee;const a={file:s,progress:0,status:"pending"};h.value.push(a);try{a.status="uploading";const O=new FormData;O.append("file",s),f.value&&O.append("folder_id",f.value.toString());const ce=await V.post("/files/upload",O,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:G=>{G.total&&(a.progress=Math.round(G.loaded*100/G.total))}});a.status="success",a.progress=100}catch(O){a.status="error",a.error=((ee=($=O.response)==null?void 0:$.data)==null?void 0:ee.message)||"上传失败"}},W=async s=>{try{await V.delete(`/files/${s}`),y.value=y.value.filter(a=>a.id!==s),v.value=v.value.filter(a=>a!==s),await n(1)}catch(a){throw a}},J=async()=>{const s=v.value.map(a=>W(a));await Promise.all(s),v.value=[],await n(1)},X=async(s,a)=>{try{await V.post("/folders",{folder_name:s,parent_folder_id:a}),await b()}catch($){throw $}},Q=async s=>{try{await V.delete(`/folders/${s}`),await b()}catch(a){throw a}},Z=async(s,a)=>{try{await V.put(`/folders/${s}`,{folder_name:a}),await b()}catch($){throw $}},K=async(s,a)=>{try{await V.put(`/files/${s}`,{original_name:a}),await n()}catch($){throw $}},Y=()=>{h.value=[]},l=s=>{v.value.includes(s)||v.value.push(s)},o=s=>{v.value=v.value.filter(a=>a!==s)};return{files:y,folders:N,currentFolder:f,loading:S,uploadProgress:h,selectedFiles:v,viewMode:L,searchQuery:k,fileTypeFilter:P,pagination:g,filteredFiles:w,selectedFilesData:x,totalSelectedSize:M,fetchFiles:n,fetchFolders:b,fetchFolderPath:p,uploadFiles:T,deleteFile:W,deleteSelectedFiles:J,createFolder:X,deleteFolder:Q,renameFolder:Z,renameFile:K,clearUploadProgress:Y,selectFile:l,unselectFile:o,toggleFileSelection:s=>{v.value.includes(s)?o(s):l(s)},toggleSelectAll:()=>{v.value.length===w.value.length?v.value=[]:v.value=w.value.map(s=>s.id)},clearSelection:()=>{v.value=[]}}}),je={class:"file-uploader"},We={key:0,class:"drop-content"},Oe={key:1,class:"uploading-content"},Je={class:"upload-progress"},Qe={class:"progress-text"},Xe={key:0,class:"upload-list"},Ze={class:"upload-list-header"},Ke={class:"upload-items"},Ye={class:"item-thumbnail"},Ge=["src","alt"],He={key:1,class:"file-icon"},es={class:"item-info"},ss={class:"item-name"},ts={class:"item-size"},as={class:"item-progress"},ls={class:"item-status"},os={class:"item-actions"},ns={key:1,class:"upload-stats"},is={class:"stats-item"},rs={class:"stats-value"},us={class:"stats-item"},cs={class:"stats-value success"},ds={class:"stats-item"},vs={class:"stats-value error"},fs=ue({__name:"FileUploader",emits:["upload-success"],setup(y,{emit:N}){const f=N,S=he(),h=d(),v=d(),L=d(!1),k=d(!1),P=d(0),g=d([]),w=R(()=>{const l=g.value.length,o=g.value.filter(_=>_.status==="success").length,i=g.value.filter(_=>_.status==="error").length;return{total:l,success:o,error:i}}),x=()=>Math.random().toString(36).substr(2,9),M=l=>new Promise(o=>{if(l.type.startsWith("image/")){const i=new FileReader;i.onload=_=>{var E;return o((E=_.target)==null?void 0:E.result)},i.readAsDataURL(l)}else o("")}),n=l=>{const i=["image/jpeg","image/png","image/gif","image/webp","image/svg+xml","video/mp4","video/webm","video/quicktime"];return l.size>104857600?(U.error(`文件 ${l.name} 超过100MB限制`),!1):i.includes(l.type)?!0:(U.error(`不支持的文件类型: ${l.type}`),!1)},b=l=>{l.preventDefault(),L.value=!0},p=l=>{l.preventDefault(),L.value=!1},T=async l=>{var i;l.preventDefault(),L.value=!1;const o=Array.from(((i=l.dataTransfer)==null?void 0:i.files)||[]);await J(o)},B=()=>{var l;(l=v.value)==null||l.click()},W=async l=>{const o=l.target,i=Array.from(o.files||[]);await J(i),o.value=""},J=async l=>{if(l.length===0)return;const o=l.filter(n);if(o.length!==0){for(const i of o){const _=await M(i),E={id:x(),file:i,preview:_,progress:0,status:"pending"};g.value.push(E)}await X()}},X=async()=>{const l=g.value.filter(i=>i.status==="pending");for(const i of l)await Q(i);if(g.value.every(i=>i.status==="success"||i.status==="error")){const i=w.value.success;i>0&&(U.success(`成功上传 ${i} 个文件`),f("upload-success"))}},Q=async l=>{var o,i;try{l.status="uploading",k.value=!0;const _=new FormData;_.append("file",l.file),S.currentFolder&&_.append("folder_id",S.currentFolder.toString());const E=await V.post("/files/upload",_,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:s=>{s.total&&(l.progress=Math.round(s.loaded*100/s.total))}});l.status="success",l.progress=100,await S.fetchFiles(1)}catch(_){l.status="error",l.error=((i=(o=_.response)==null?void 0:o.data)==null?void 0:i.message)||_.message||"上传失败"}finally{k.value=!1}},Z=async l=>{l.status="pending",l.progress=0,l.error=void 0,await Q(l)},K=l=>{const o=g.value.findIndex(i=>i.id===l);o>-1&&g.value.splice(o,1)},Y=()=>{g.value=[]};return(l,o)=>{const i=ne,_=Ce,E=ie;return m(),F("div",je,[e("div",{ref_key:"dropZoneRef",ref:h,class:le(["drop-zone",{"is-dragover":L.value,"is-uploading":k.value}]),onDrop:T,onDragover:b,onDragleave:p,onClick:B},[k.value?(m(),F("div",Oe,[t(i,{class:"loading-icon"},{default:r(()=>[t(u(se))]),_:1}),o[1]||(o[1]=e("h3",{class:"uploading-title"},"正在上传文件...",-1)),e("div",Je,[t(_,{percentage:P.value,"stroke-width":8,"show-text":!1},null,8,["percentage"]),e("span",Qe,C(P.value)+"%",1)])])):(m(),F("div",We,[t(i,{class:"upload-icon"},{default:r(()=>[t(u(Fe))]),_:1}),o[0]||(o[0]=Ae('<h3 class="upload-title" data-v-1f8d8472>拖拽文件到此处上传</h3><p class="upload-subtitle" data-v-1f8d8472>或点击选择文件</p><div class="upload-tips" data-v-1f8d8472><span class="tip-item" data-v-1f8d8472>支持图片和视频文件</span><span class="tip-item" data-v-1f8d8472>单个文件最大100MB</span></div>',3))]))],34),e("input",{ref_key:"fileInputRef",ref:v,type:"file",multiple:"",accept:"image/*,video/*",style:{display:"none"},onChange:W},null,544),g.value.length>0?(m(),F("div",Xe,[e("div",Ze,[o[3]||(o[3]=e("h4",null,"上传队列",-1)),t(E,{type:"text",onClick:Y},{default:r(()=>[...o[2]||(o[2]=[z("清空",-1)])]),_:1})]),e("div",Ke,[(m(!0),F(Ie,null,qe(g.value,s=>(m(),F("div",{key:s.id,class:le(["upload-item",s.status])},[e("div",Ye,[s.file.type.startsWith("image/")?(m(),F("img",{key:0,src:s.preview,alt:s.file.name,class:"thumbnail-image"},null,8,Ge)):(m(),F("div",He,[t(i,null,{default:r(()=>[t(u(ae))]),_:1})]))]),e("div",es,[e("div",ss,C(s.file.name),1),e("div",ts,C(u(re)(s.file.size)),1),e("div",as,[t(_,{percentage:s.progress,"stroke-width":4,"show-text":!1},null,8,["percentage"])])]),e("div",ls,[s.status==="pending"?(m(),q(i,{key:0,class:"status-icon"},{default:r(()=>[t(u(be))]),_:1})):s.status==="uploading"?(m(),q(i,{key:1,class:"status-icon uploading"},{default:r(()=>[t(u(se))]),_:1})):s.status==="success"?(m(),q(i,{key:2,class:"status-icon success"},{default:r(()=>[t(u(Se))]),_:1})):s.status==="error"?(m(),q(i,{key:3,class:"status-icon error"},{default:r(()=>[t(u(Pe))]),_:1})):j("",!0)]),e("div",os,[s.status==="error"?(m(),q(E,{key:0,type:"text",size:"small",onClick:a=>Z(s)},{default:r(()=>[...o[4]||(o[4]=[z(" 重试 ",-1)])]),_:1},8,["onClick"])):j("",!0),t(E,{type:"text",size:"small",onClick:a=>K(s.id)},{default:r(()=>[...o[5]||(o[5]=[z(" 移除 ",-1)])]),_:1},8,["onClick"])])],2))),128))])])):j("",!0),w.value.total>0?(m(),F("div",ns,[e("div",is,[o[6]||(o[6]=e("span",{class:"stats-label"},"总计:",-1)),e("span",rs,C(w.value.total),1)]),e("div",us,[o[7]||(o[7]=e("span",{class:"stats-label"},"成功:",-1)),e("span",cs,C(w.value.success),1)]),e("div",ds,[o[8]||(o[8]=e("span",{class:"stats-label"},"失败:",-1)),e("span",vs,C(w.value.error),1)])])):j("",!0)])}}}),mt=oe(fs,[["__scopeId","data-v-1f8d8472"]]),ps={class:"video-container"},ms=["src","poster"],_s={key:0,class:"loading-overlay"},gs={key:1,class:"error-overlay"},ys={key:2,class:"custom-controls"},hs={class:"progress-bar"},ws={class:"controls-bar"},ks={class:"controls-left"},$s={class:"time-display"},Fs={class:"controls-center"},Cs={class:"controls-right"},bs={class:"video-info"},Ss={class:"info-header"},Ps={class:"info-grid"},xs={class:"info-item"},Ls={class:"value"},Ts={class:"info-item"},Es={class:"value"},Ds={class:"info-item"},Us={class:"value"},zs={class:"info-item"},Ms={class:"value"},Vs={class:"info-item"},Rs={class:"value"},Bs={class:"player-actions"},As=ue({__name:"VideoPlayer",props:{video:{},showCustomControls:{type:Boolean}},emits:["close","video-end","load","error"],setup(y,{emit:N}){const f=y,S=N,h=d(!0),v=d(!1),L=d(!1),k=d(!1),P=d(!1),g=d(0),w=d(0),x=d(100),M=d(0),n=d(),b=R(()=>te(f.video.id)),p=R(()=>f.video.thumbnail_path?te(f.video.id):void 0),T=R(()=>f.video.original_name),B=R(()=>f.video.file_size),W=R(()=>f.video.mime_type),J=R(()=>f.video.created_at),X=()=>{h.value=!0,v.value=!1},Q=()=>{var D;h.value=!1,w.value=((D=n.value)==null?void 0:D.duration)||0,S("load")},Z=()=>{h.value=!1,S("load")},K=()=>{k.value=!0},Y=()=>{k.value=!1},l=()=>{k.value=!1,S("video-end")},o=()=>{h.value=!1,v.value=!0,S("error")},i=()=>{n.value&&(g.value=n.value.currentTime,M.value=g.value/w.value*100)},_=()=>{n.value&&(n.value.volume=x.value/100,P.value=n.value.muted)},E=()=>{h.value=!0,v.value=!1,n.value&&n.value.load()},s=()=>{n.value&&(k.value?n.value.pause():n.value.play())},a=()=>{n.value&&(n.value.muted=!n.value.muted,P.value=n.value.muted)},$=()=>{n.value&&(n.value.requestFullscreen?n.value.requestFullscreen():n.value.webkitRequestFullscreen?n.value.webkitRequestFullscreen():n.value.msRequestFullscreen&&n.value.msRequestFullscreen())},ee=D=>{if(n.value&&w.value>0){const c=D.target.getBoundingClientRect(),I=(D.clientX-c.left)/c.width*w.value;n.value.currentTime=I}},O=()=>{try{me(f.video.id,f.video.original_name),U.success("开始下载视频")}catch{U.error("下载失败")}},ce=()=>{window.open(b.value,"_blank")},G=async()=>{const D=`${window.location.origin}${b.value}`;await _e(D)?U.success("链接已复制到剪贴板"):U.error("复制失败")},de=D=>{if(n.value)switch(D.key){case" ":case"Space":D.preventDefault(),s();break;case"Escape":S("close");break;case"ArrowLeft":n.value.currentTime=Math.max(0,n.value.currentTime-10);break;case"ArrowRight":n.value.currentTime=Math.min(w.value,n.value.currentTime+10);break;case"ArrowUp":x.value=Math.min(100,x.value+10),_();break;case"ArrowDown":x.value=Math.max(0,x.value-10),_();break;case"m":case"M":a();break;case"f":case"F":$();break}};return Ne(()=>f.video,()=>{h.value=!0,v.value=!1,k.value=!1,g.value=0,w.value=0,M.value=0}),ge(()=>{document.addEventListener("keydown",de),document.addEventListener("fullscreenchange",()=>{L.value=!!document.fullscreenElement})}),ye(()=>{document.removeEventListener("keydown",de),document.removeEventListener("fullscreenchange",()=>{L.value=!!document.fullscreenElement}),n.value&&(n.value.pause(),n.value.src="")}),(D,c)=>{const A=ne,I=ie,we=Le,ke=Ue;return m(),F("div",{class:le(["video-player",{fullscreen:L.value}])},[e("div",ps,[e("video",{ref_key:"videoRef",ref:n,src:b.value,poster:p.value,class:"player-video",controls:"",preload:"metadata",onLoadstart:X,onLoadedmetadata:Q,onCanplay:Z,onPlay:K,onPause:Y,onEnded:l,onError:o,onTimeupdate:i,onVolumechange:_}," 您的浏览器不支持视频播放 ",40,ms),h.value?(m(),F("div",_s,[t(A,{class:"loading-icon"},{default:r(()=>[t(u(se))]),_:1}),c[1]||(c[1]=e("p",null,"正在加载视频...",-1))])):j("",!0),v.value?(m(),F("div",gs,[t(A,{class:"error-icon"},{default:r(()=>[t(u(ae))]),_:1}),c[3]||(c[3]=e("p",null,"视频加载失败",-1)),t(I,{onClick:E},{default:r(()=>[...c[2]||(c[2]=[z("重试",-1)])]),_:1})])):j("",!0),y.showCustomControls?(m(),F("div",ys,[e("div",hs,[e("div",{class:"progress-track",onClick:ee},[e("div",{class:"progress-fill",style:ve({width:M.value+"%"})},null,4),e("div",{class:"progress-handle",style:ve({left:M.value+"%"})},null,4)])]),e("div",ws,[e("div",ks,[t(I,{onClick:s,class:"play-button"},{default:r(()=>[t(A,null,{default:r(()=>[k.value?(m(),q(u(xe),{key:1})):(m(),q(u(ae),{key:0}))]),_:1})]),_:1}),e("div",$s,C(u(H)(g.value))+" / "+C(u(H)(w.value)),1)]),e("div",Fs,[t(we,{modelValue:x.value,"onUpdate:modelValue":c[0]||(c[0]=$e=>x.value=$e),min:0,max:100,"show-tooltip":!1,class:"volume-slider",onChange:_},null,8,["modelValue"]),t(I,{onClick:a,class:"volume-button"},{default:r(()=>[t(A,null,{default:r(()=>[P.value?(m(),q(u(Ee),{key:1})):(m(),q(u(Te),{key:0}))]),_:1})]),_:1})]),e("div",Cs,[t(I,{onClick:$,class:"fullscreen-button"},{default:r(()=>[t(A,null,{default:r(()=>[t(u(De))]),_:1})]),_:1})])])])):j("",!0)]),e("div",bs,[e("div",Ss,[e("h3",null,C(T.value),1),t(ke,{type:"primary"},{default:r(()=>[...c[4]||(c[4]=[z("视频",-1)])]),_:1})]),e("div",Ps,[e("div",xs,[c[5]||(c[5]=e("span",{class:"label"},"文件名:",-1)),e("span",Ls,C(T.value),1)]),e("div",Ts,[c[6]||(c[6]=e("span",{class:"label"},"时长:",-1)),e("span",Es,C(u(H)(w.value)),1)]),e("div",Ds,[c[7]||(c[7]=e("span",{class:"label"},"文件大小:",-1)),e("span",Us,C(u(re)(B.value)),1)]),e("div",zs,[c[8]||(c[8]=e("span",{class:"label"},"文件类型:",-1)),e("span",Ms,C(W.value),1)]),e("div",Vs,[c[9]||(c[9]=e("span",{class:"label"},"上传时间:",-1)),e("span",Rs,C(u(H)(J.value)),1)])])]),e("div",Bs,[t(I,{type:"primary",onClick:O},{default:r(()=>[t(A,null,{default:r(()=>[t(u(fe))]),_:1}),c[10]||(c[10]=z(" 下载视频 ",-1))]),_:1}),t(I,{onClick:ce},{default:r(()=>[t(A,null,{default:r(()=>[t(u(ze))]),_:1}),c[11]||(c[11]=z(" 在新窗口打开 ",-1))]),_:1}),t(I,{onClick:G},{default:r(()=>[t(A,null,{default:r(()=>[t(u(pe))]),_:1}),c[12]||(c[12]=z(" 复制链接 ",-1))]),_:1})])],2)}}}),Is=oe(As,[["__scopeId","data-v-31523ab6"]]),qs={class:"file-preview"},Ns={key:0,class:"image-preview"},js={class:"preview-image-container"},Ws=["src","alt"],Os={key:0,class:"loading-overlay"},Js={class:"image-info"},Qs={class:"info-grid"},Xs={class:"info-item"},Zs={class:"value"},Ks={class:"info-item"},Ys={class:"value"},Gs={class:"info-item"},Hs={class:"value"},et={key:1,class:"video-preview"},st={key:2,class:"unknown-preview"},tt={class:"preview-actions"},at=ue({__name:"FilePreview",props:{file:{}},emits:["file-deleted","close"],setup(y,{emit:N}){const f=y,S=he(),h=d(!0);d(!1);const v=d(),L=()=>{h.value=!1},k=()=>{h.value=!1},P=()=>{h.value=!1},g=()=>{h.value=!1},w=()=>{try{me(f.file.id,f.file.original_name),U.success("开始下载文件")}catch{U.error("下载失败")}},x=async()=>{const b=`${window.location.origin}${te(f.file.id)}`;await _e(b)?U.success("链接已复制到剪贴板"):U.error("复制失败")},M=async()=>{try{await Re.confirm(`确定要删除文件 "${f.file.original_name}" 吗？`,"删除确认",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}),await S.deleteFile(f.file.id),U.success("文件删除成功"),n("file-deleted",f.file.id)}catch{}},n=N;return ge(()=>{h.value=!0}),ye(()=>{v.value&&(v.value.pause(),v.value.src="")}),(b,p)=>{const T=ne,B=ie;return m(),F("div",qs,[y.file.file_type==="image"?(m(),F("div",Ns,[e("div",js,[e("img",{src:u(te)(y.file.id),alt:y.file.original_name,class:"preview-image",onLoad:L,onError:k},null,40,Ws),h.value?(m(),F("div",Os,[t(T,{class:"loading-icon"},{default:r(()=>[t(u(se))]),_:1}),p[1]||(p[1]=e("p",null,"正在加载预览...",-1))])):j("",!0)]),e("div",Js,[e("h3",null,C(y.file.original_name),1),e("div",Qs,[e("div",Xs,[p[2]||(p[2]=e("span",{class:"label"},"文件大小:",-1)),e("span",Zs,C(u(re)(y.file.file_size)),1)]),e("div",Ks,[p[3]||(p[3]=e("span",{class:"label"},"文件类型:",-1)),e("span",Ys,C(y.file.mime_type),1)]),e("div",Gs,[p[4]||(p[4]=e("span",{class:"label"},"上传时间:",-1)),e("span",Hs,C(u(H)(y.file.created_at)),1)])])])])):y.file.file_type==="video"?(m(),F("div",et,[t(Is,{video:y.file,onClose:p[0]||(p[0]=W=>b.$emit("close")),onLoad:P,onError:g},null,8,["video"])])):(m(),F("div",st,[t(T,{class:"unknown-icon"},{default:r(()=>[t(u(Me))]),_:1}),p[5]||(p[5]=e("h3",null,"不支持的文件类型",-1)),p[6]||(p[6]=e("p",null,"无法预览此类型的文件",-1))])),e("div",tt,[t(B,{type:"primary",onClick:w},{default:r(()=>[t(T,null,{default:r(()=>[t(u(fe))]),_:1}),p[7]||(p[7]=z(" 下载 ",-1))]),_:1}),t(B,{onClick:x},{default:r(()=>[t(T,null,{default:r(()=>[t(u(pe))]),_:1}),p[8]||(p[8]=z(" 复制链接 ",-1))]),_:1}),t(B,{type:"danger",onClick:M},{default:r(()=>[t(T,null,{default:r(()=>[t(u(Ve))]),_:1}),p[9]||(p[9]=z(" 删除 ",-1))]),_:1})])])}}}),_t=oe(at,[["__scopeId","data-v-512500a0"]]);export{_t as F,mt as a,he as u};
