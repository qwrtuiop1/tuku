import{_ as oe}from"./_plugin-vue_export-helper-BwE83l92.js";/* empty css                    */import{b as ne,j as Fe,k as se,J as Ce,c as ie,E as U,X as ae,A as be,w as Se,aj as Pe,ak as xe,al as Le,am as Te,an as Ee,ao as De,ap as Ue,$ as fe,a0 as ze,s as pe,Y as Me,a9 as Ve,W as Re}from"./element-CHj0RLGm.js";import{f as re,c as te,h as H,d as me,e as _e}from"./helpers-iwoUo1o7.js";import{a as V}from"./index-DirPTg0b.js";import{ax as Be,r as d,c as R,y as ce,z as F,A as m,B as e,L as j,R as a,aB as Ae,J as r,u as c,P as C,E as le,O as z,Q as Ie,a6 as qe,I as q,w as Ne,j as ge,U as ye,D as ve}from"./vendor-BcB6VvZI.js";/* empty css               *//* empty css                  *//* empty css                 *//* empty css                        *//* empty css                  */const he=Be("files",()=>{const h=d([]),N=d([]),f=d(null),S=d(!1),w=d([]),v=d([]),L=d("grid"),$=d(""),P=d("all"),g=d({page:1,limit:20,total:0,pages:0}),k=R(()=>{let s=h.value;if(P.value!=="all"&&(s=s.filter(t=>t.file_type===P.value)),$.value){const t=$.value.toLowerCase();s=s.filter(y=>y.original_name.toLowerCase().includes(t)||y.filename.toLowerCase().includes(t))}return s}),x=R(()=>h.value.filter(s=>v.value.includes(s.id))),M=R(()=>x.value.reduce((s,t)=>s+t.file_size,0)),n=async(s=1)=>{S.value=!0;try{const t={page:s,limit:g.value.limit};f.value&&(t.folder_id=f.value),P.value!=="all"&&(t.file_type=P.value),$.value&&(t.search=$.value);const y=await V.get("/files",{params:t});h.value=y.data.files,g.value=y.data.pagination}catch(t){console.error("获取文件列表失败:",t)}finally{S.value=!1}},b=async()=>{try{const s={};f.value&&(s.parent_id=f.value);const t=await V.get("/folders",{params:s});N.value=t.data.folders}catch(s){console.error("获取文件夹列表失败:",s)}},p=async s=>{try{return(await V.get(`/folders/path/${s}`)).data.path}catch(t){return console.error("获取文件夹路径失败:",t),[]}},T=async s=>{const t=Array.from(s).map(y=>B(y));await Promise.all(t),await n()},B=async s=>{var y,ee;const t={file:s,progress:0,status:"pending"};w.value.push(t);try{t.status="uploading";const O=new FormData;O.append("file",s),f.value&&O.append("folder_id",f.value.toString());const ue=await V.post("/files/upload",O,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:G=>{G.total&&(t.progress=Math.round(G.loaded*100/G.total))}});t.status="success",t.progress=100}catch(O){t.status="error",t.error=((ee=(y=O.response)==null?void 0:y.data)==null?void 0:ee.message)||"上传失败"}},W=async s=>{try{await V.delete(`/files/${s}`),h.value=h.value.filter(t=>t.id!==s),v.value=v.value.filter(t=>t!==s),await n(1)}catch(t){throw console.error("删除文件失败:",t),t}},J=async()=>{const s=v.value.map(t=>W(t));await Promise.all(s),v.value=[],await n(1)},X=async(s,t)=>{try{await V.post("/folders",{folder_name:s,parent_folder_id:t}),await b()}catch(y){throw console.error("创建文件夹失败:",y),y}},Q=async s=>{try{await V.delete(`/folders/${s}`),await b()}catch(t){throw console.error("删除文件夹失败:",t),t}},Z=async(s,t)=>{try{await V.put(`/folders/${s}`,{folder_name:t}),await b()}catch(y){throw console.error("重命名文件夹失败:",y),y}},K=async(s,t)=>{try{await V.put(`/files/${s}`,{original_name:t}),await n()}catch(y){throw console.error("重命名文件失败:",y),y}},Y=()=>{w.value=[]},l=s=>{v.value.includes(s)||v.value.push(s)},o=s=>{v.value=v.value.filter(t=>t!==s)};return{files:h,folders:N,currentFolder:f,loading:S,uploadProgress:w,selectedFiles:v,viewMode:L,searchQuery:$,fileTypeFilter:P,pagination:g,filteredFiles:k,selectedFilesData:x,totalSelectedSize:M,fetchFiles:n,fetchFolders:b,fetchFolderPath:p,uploadFiles:T,deleteFile:W,deleteSelectedFiles:J,createFolder:X,deleteFolder:Q,renameFolder:Z,renameFile:K,clearUploadProgress:Y,selectFile:l,unselectFile:o,toggleFileSelection:s=>{v.value.includes(s)?o(s):l(s)},toggleSelectAll:()=>{v.value.length===k.value.length?v.value=[]:v.value=k.value.map(s=>s.id)},clearSelection:()=>{v.value=[]}}}),je={class:"file-uploader"},We={key:0,class:"drop-content"},Oe={key:1,class:"uploading-content"},Je={class:"upload-progress"},Qe={class:"progress-text"},Xe={key:0,class:"upload-list"},Ze={class:"upload-list-header"},Ke={class:"upload-items"},Ye={class:"item-thumbnail"},Ge=["src","alt"],He={key:1,class:"file-icon"},es={class:"item-info"},ss={class:"item-name"},ts={class:"item-size"},as={class:"item-progress"},ls={class:"item-status"},os={class:"item-actions"},ns={key:1,class:"upload-stats"},is={class:"stats-item"},rs={class:"stats-value"},cs={class:"stats-item"},us={class:"stats-value success"},ds={class:"stats-item"},vs={class:"stats-value error"},fs=ce({__name:"FileUploader",emits:["upload-success"],setup(h,{emit:N}){const f=N,S=he(),w=d(),v=d(),L=d(!1),$=d(!1),P=d(0),g=d([]),k=R(()=>{const l=g.value.length,o=g.value.filter(_=>_.status==="success").length,i=g.value.filter(_=>_.status==="error").length;return{total:l,success:o,error:i}}),x=()=>Math.random().toString(36).substr(2,9),M=l=>new Promise(o=>{if(l.type.startsWith("image/")){const i=new FileReader;i.onload=_=>{var E;return o((E=_.target)==null?void 0:E.result)},i.readAsDataURL(l)}else o("")}),n=l=>{const i=["image/jpeg","image/png","image/gif","image/webp","image/svg+xml","video/mp4","video/webm","video/quicktime"];return l.size>104857600?(U.error(`文件 ${l.name} 超过100MB限制`),!1):i.includes(l.type)?!0:(U.error(`不支持的文件类型: ${l.type}`),!1)},b=l=>{l.preventDefault(),L.value=!0},p=l=>{l.preventDefault(),L.value=!1},T=async l=>{var i;l.preventDefault(),L.value=!1;const o=Array.from(((i=l.dataTransfer)==null?void 0:i.files)||[]);await J(o)},B=()=>{var l;(l=v.value)==null||l.click()},W=async l=>{const o=l.target,i=Array.from(o.files||[]);await J(i),o.value=""},J=async l=>{if(l.length===0)return;const o=l.filter(n);if(o.length!==0){for(const i of o){const _=await M(i),E={id:x(),file:i,preview:_,progress:0,status:"pending"};g.value.push(E)}await X()}},X=async()=>{const l=g.value.filter(i=>i.status==="pending");for(const i of l)await Q(i);if(g.value.every(i=>i.status==="success"||i.status==="error")){const i=k.value.success;i>0&&(U.success(`成功上传 ${i} 个文件`),f("upload-success"))}},Q=async l=>{var o,i;try{l.status="uploading",$.value=!0;const _=new FormData;_.append("file",l.file),S.currentFolder&&_.append("folder_id",S.currentFolder.toString());const E=await V.post("/files/upload",_,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:s=>{s.total&&(l.progress=Math.round(s.loaded*100/s.total))}});l.status="success",l.progress=100,await S.fetchFiles(1)}catch(_){l.status="error",l.error=((i=(o=_.response)==null?void 0:o.data)==null?void 0:i.message)||_.message||"上传失败"}finally{$.value=!1}},Z=async l=>{l.status="pending",l.progress=0,l.error=void 0,await Q(l)},K=l=>{const o=g.value.findIndex(i=>i.id===l);o>-1&&g.value.splice(o,1)},Y=()=>{g.value=[]};return(l,o)=>{const i=ne,_=Ce,E=ie;return m(),F("div",je,[e("div",{ref_key:"dropZoneRef",ref:w,class:le(["drop-zone",{"is-dragover":L.value,"is-uploading":$.value}]),onDrop:T,onDragover:b,onDragleave:p,onClick:B},[$.value?(m(),F("div",Oe,[a(i,{class:"loading-icon"},{default:r(()=>[a(c(se))]),_:1}),o[1]||(o[1]=e("h3",{class:"uploading-title"},"正在上传文件...",-1)),e("div",Je,[a(_,{percentage:P.value,"stroke-width":8,"show-text":!1},null,8,["percentage"]),e("span",Qe,C(P.value)+"%",1)])])):(m(),F("div",We,[a(i,{class:"upload-icon"},{default:r(()=>[a(c(Fe))]),_:1}),o[0]||(o[0]=Ae('<h3 class="upload-title" data-v-1f8d8472>拖拽文件到此处上传</h3><p class="upload-subtitle" data-v-1f8d8472>或点击选择文件</p><div class="upload-tips" data-v-1f8d8472><span class="tip-item" data-v-1f8d8472>支持图片和视频文件</span><span class="tip-item" data-v-1f8d8472>单个文件最大100MB</span></div>',3))]))],34),e("input",{ref_key:"fileInputRef",ref:v,type:"file",multiple:"",accept:"image/*,video/*",style:{display:"none"},onChange:W},null,544),g.value.length>0?(m(),F("div",Xe,[e("div",Ze,[o[3]||(o[3]=e("h4",null,"上传队列",-1)),a(E,{type:"text",onClick:Y},{default:r(()=>[...o[2]||(o[2]=[z("清空",-1)])]),_:1})]),e("div",Ke,[(m(!0),F(Ie,null,qe(g.value,s=>(m(),F("div",{key:s.id,class:le(["upload-item",s.status])},[e("div",Ye,[s.file.type.startsWith("image/")?(m(),F("img",{key:0,src:s.preview,alt:s.file.name,class:"thumbnail-image"},null,8,Ge)):(m(),F("div",He,[a(i,null,{default:r(()=>[a(c(ae))]),_:1})]))]),e("div",es,[e("div",ss,C(s.file.name),1),e("div",ts,C(c(re)(s.file.size)),1),e("div",as,[a(_,{percentage:s.progress,"stroke-width":4,"show-text":!1},null,8,["percentage"])])]),e("div",ls,[s.status==="pending"?(m(),q(i,{key:0,class:"status-icon"},{default:r(()=>[a(c(be))]),_:1})):s.status==="uploading"?(m(),q(i,{key:1,class:"status-icon uploading"},{default:r(()=>[a(c(se))]),_:1})):s.status==="success"?(m(),q(i,{key:2,class:"status-icon success"},{default:r(()=>[a(c(Se))]),_:1})):s.status==="error"?(m(),q(i,{key:3,class:"status-icon error"},{default:r(()=>[a(c(Pe))]),_:1})):j("",!0)]),e("div",os,[s.status==="error"?(m(),q(E,{key:0,type:"text",size:"small",onClick:t=>Z(s)},{default:r(()=>[...o[4]||(o[4]=[z(" 重试 ",-1)])]),_:1},8,["onClick"])):j("",!0),a(E,{type:"text",size:"small",onClick:t=>K(s.id)},{default:r(()=>[...o[5]||(o[5]=[z(" 移除 ",-1)])]),_:1},8,["onClick"])])],2))),128))])])):j("",!0),k.value.total>0?(m(),F("div",ns,[e("div",is,[o[6]||(o[6]=e("span",{class:"stats-label"},"总计:",-1)),e("span",rs,C(k.value.total),1)]),e("div",cs,[o[7]||(o[7]=e("span",{class:"stats-label"},"成功:",-1)),e("span",us,C(k.value.success),1)]),e("div",ds,[o[8]||(o[8]=e("span",{class:"stats-label"},"失败:",-1)),e("span",vs,C(k.value.error),1)])])):j("",!0)])}}}),mt=oe(fs,[["__scopeId","data-v-1f8d8472"]]),ps={class:"video-container"},ms=["src","poster"],_s={key:0,class:"loading-overlay"},gs={key:1,class:"error-overlay"},ys={key:2,class:"custom-controls"},hs={class:"progress-bar"},ws={class:"controls-bar"},ks={class:"controls-left"},$s={class:"time-display"},Fs={class:"controls-center"},Cs={class:"controls-right"},bs={class:"video-info"},Ss={class:"info-header"},Ps={class:"info-grid"},xs={class:"info-item"},Ls={class:"value"},Ts={class:"info-item"},Es={class:"value"},Ds={class:"info-item"},Us={class:"value"},zs={class:"info-item"},Ms={class:"value"},Vs={class:"info-item"},Rs={class:"value"},Bs={class:"player-actions"},As=ce({__name:"VideoPlayer",props:{video:{},showCustomControls:{type:Boolean}},emits:["close","video-end","load","error"],setup(h,{emit:N}){const f=h,S=N,w=d(!0),v=d(!1),L=d(!1),$=d(!1),P=d(!1),g=d(0),k=d(0),x=d(100),M=d(0),n=d(),b=R(()=>te(f.video.id)),p=R(()=>f.video.thumbnail_path?te(f.video.id):void 0),T=R(()=>f.video.original_name),B=R(()=>f.video.file_size),W=R(()=>f.video.mime_type),J=R(()=>f.video.created_at),X=()=>{w.value=!0,v.value=!1},Q=()=>{var D;w.value=!1,k.value=((D=n.value)==null?void 0:D.duration)||0,S("load")},Z=()=>{w.value=!1,S("load")},K=()=>{$.value=!0},Y=()=>{$.value=!1},l=()=>{$.value=!1,S("video-end")},o=()=>{w.value=!1,v.value=!0,S("error")},i=()=>{n.value&&(g.value=n.value.currentTime,M.value=g.value/k.value*100)},_=()=>{n.value&&(n.value.volume=x.value/100,P.value=n.value.muted)},E=()=>{w.value=!0,v.value=!1,n.value&&n.value.load()},s=()=>{n.value&&($.value?n.value.pause():n.value.play())},t=()=>{n.value&&(n.value.muted=!n.value.muted,P.value=n.value.muted)},y=()=>{n.value&&(n.value.requestFullscreen?n.value.requestFullscreen():n.value.webkitRequestFullscreen?n.value.webkitRequestFullscreen():n.value.msRequestFullscreen&&n.value.msRequestFullscreen())},ee=D=>{if(n.value&&k.value>0){const u=D.target.getBoundingClientRect(),I=(D.clientX-u.left)/u.width*k.value;n.value.currentTime=I}},O=()=>{try{me(f.video.id,f.video.original_name),U.success("开始下载视频")}catch{U.error("下载失败")}},ue=()=>{window.open(b.value,"_blank")},G=async()=>{const D=`${window.location.origin}${b.value}`;await _e(D)?U.success("链接已复制到剪贴板"):U.error("复制失败")},de=D=>{if(n.value)switch(D.key){case" ":case"Space":D.preventDefault(),s();break;case"Escape":S("close");break;case"ArrowLeft":n.value.currentTime=Math.max(0,n.value.currentTime-10);break;case"ArrowRight":n.value.currentTime=Math.min(k.value,n.value.currentTime+10);break;case"ArrowUp":x.value=Math.min(100,x.value+10),_();break;case"ArrowDown":x.value=Math.max(0,x.value-10),_();break;case"m":case"M":t();break;case"f":case"F":y();break}};return Ne(()=>f.video,()=>{w.value=!0,v.value=!1,$.value=!1,g.value=0,k.value=0,M.value=0}),ge(()=>{document.addEventListener("keydown",de),document.addEventListener("fullscreenchange",()=>{L.value=!!document.fullscreenElement})}),ye(()=>{document.removeEventListener("keydown",de),document.removeEventListener("fullscreenchange",()=>{L.value=!!document.fullscreenElement}),n.value&&(n.value.pause(),n.value.src="")}),(D,u)=>{const A=ne,I=ie,we=Le,ke=Ue;return m(),F("div",{class:le(["video-player",{fullscreen:L.value}])},[e("div",ps,[e("video",{ref_key:"videoRef",ref:n,src:b.value,poster:p.value,class:"player-video",controls:"",preload:"metadata",onLoadstart:X,onLoadedmetadata:Q,onCanplay:Z,onPlay:K,onPause:Y,onEnded:l,onError:o,onTimeupdate:i,onVolumechange:_}," 您的浏览器不支持视频播放 ",40,ms),w.value?(m(),F("div",_s,[a(A,{class:"loading-icon"},{default:r(()=>[a(c(se))]),_:1}),u[1]||(u[1]=e("p",null,"正在加载视频...",-1))])):j("",!0),v.value?(m(),F("div",gs,[a(A,{class:"error-icon"},{default:r(()=>[a(c(ae))]),_:1}),u[3]||(u[3]=e("p",null,"视频加载失败",-1)),a(I,{onClick:E},{default:r(()=>[...u[2]||(u[2]=[z("重试",-1)])]),_:1})])):j("",!0),h.showCustomControls?(m(),F("div",ys,[e("div",hs,[e("div",{class:"progress-track",onClick:ee},[e("div",{class:"progress-fill",style:ve({width:M.value+"%"})},null,4),e("div",{class:"progress-handle",style:ve({left:M.value+"%"})},null,4)])]),e("div",ws,[e("div",ks,[a(I,{onClick:s,class:"play-button"},{default:r(()=>[a(A,null,{default:r(()=>[$.value?(m(),q(c(xe),{key:1})):(m(),q(c(ae),{key:0}))]),_:1})]),_:1}),e("div",$s,C(c(H)(g.value))+" / "+C(c(H)(k.value)),1)]),e("div",Fs,[a(we,{modelValue:x.value,"onUpdate:modelValue":u[0]||(u[0]=$e=>x.value=$e),min:0,max:100,"show-tooltip":!1,class:"volume-slider",onChange:_},null,8,["modelValue"]),a(I,{onClick:t,class:"volume-button"},{default:r(()=>[a(A,null,{default:r(()=>[P.value?(m(),q(c(Ee),{key:1})):(m(),q(c(Te),{key:0}))]),_:1})]),_:1})]),e("div",Cs,[a(I,{onClick:y,class:"fullscreen-button"},{default:r(()=>[a(A,null,{default:r(()=>[a(c(De))]),_:1})]),_:1})])])])):j("",!0)]),e("div",bs,[e("div",Ss,[e("h3",null,C(T.value),1),a(ke,{type:"primary"},{default:r(()=>[...u[4]||(u[4]=[z("视频",-1)])]),_:1})]),e("div",Ps,[e("div",xs,[u[5]||(u[5]=e("span",{class:"label"},"文件名:",-1)),e("span",Ls,C(T.value),1)]),e("div",Ts,[u[6]||(u[6]=e("span",{class:"label"},"时长:",-1)),e("span",Es,C(c(H)(k.value)),1)]),e("div",Ds,[u[7]||(u[7]=e("span",{class:"label"},"文件大小:",-1)),e("span",Us,C(c(re)(B.value)),1)]),e("div",zs,[u[8]||(u[8]=e("span",{class:"label"},"文件类型:",-1)),e("span",Ms,C(W.value),1)]),e("div",Vs,[u[9]||(u[9]=e("span",{class:"label"},"上传时间:",-1)),e("span",Rs,C(c(H)(J.value)),1)])])]),e("div",Bs,[a(I,{type:"primary",onClick:O},{default:r(()=>[a(A,null,{default:r(()=>[a(c(fe))]),_:1}),u[10]||(u[10]=z(" 下载视频 ",-1))]),_:1}),a(I,{onClick:ue},{default:r(()=>[a(A,null,{default:r(()=>[a(c(ze))]),_:1}),u[11]||(u[11]=z(" 在新窗口打开 ",-1))]),_:1}),a(I,{onClick:G},{default:r(()=>[a(A,null,{default:r(()=>[a(c(pe))]),_:1}),u[12]||(u[12]=z(" 复制链接 ",-1))]),_:1})])],2)}}}),Is=oe(As,[["__scopeId","data-v-31523ab6"]]),qs={class:"file-preview"},Ns={key:0,class:"image-preview"},js={class:"preview-image-container"},Ws=["src","alt"],Os={key:0,class:"loading-overlay"},Js={class:"image-info"},Qs={class:"info-grid"},Xs={class:"info-item"},Zs={class:"value"},Ks={class:"info-item"},Ys={class:"value"},Gs={class:"info-item"},Hs={class:"value"},et={key:1,class:"video-preview"},st={key:2,class:"unknown-preview"},tt={class:"preview-actions"},at=ce({__name:"FilePreview",props:{file:{}},emits:["file-deleted","close"],setup(h,{emit:N}){const f=h,S=he(),w=d(!0);d(!1);const v=d(),L=()=>{w.value=!1},$=()=>{w.value=!1},P=()=>{w.value=!1},g=()=>{w.value=!1},k=()=>{try{me(f.file.id,f.file.original_name),U.success("开始下载文件")}catch{U.error("下载失败")}},x=async()=>{const b=`${window.location.origin}${te(f.file.id)}`;await _e(b)?U.success("链接已复制到剪贴板"):U.error("复制失败")},M=async()=>{try{await Re.confirm(`确定要删除文件 "${f.file.original_name}" 吗？`,"删除确认",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}),await S.deleteFile(f.file.id),U.success("文件删除成功"),n("file-deleted",f.file.id)}catch{}},n=N;return ge(()=>{w.value=!0}),ye(()=>{v.value&&(v.value.pause(),v.value.src="")}),(b,p)=>{const T=ne,B=ie;return m(),F("div",qs,[h.file.file_type==="image"?(m(),F("div",Ns,[e("div",js,[e("img",{src:c(te)(h.file.id),alt:h.file.original_name,class:"preview-image",onLoad:L,onError:$},null,40,Ws),w.value?(m(),F("div",Os,[a(T,{class:"loading-icon"},{default:r(()=>[a(c(se))]),_:1}),p[1]||(p[1]=e("p",null,"正在加载预览...",-1))])):j("",!0)]),e("div",Js,[e("h3",null,C(h.file.original_name),1),e("div",Qs,[e("div",Xs,[p[2]||(p[2]=e("span",{class:"label"},"文件大小:",-1)),e("span",Zs,C(c(re)(h.file.file_size)),1)]),e("div",Ks,[p[3]||(p[3]=e("span",{class:"label"},"文件类型:",-1)),e("span",Ys,C(h.file.mime_type),1)]),e("div",Gs,[p[4]||(p[4]=e("span",{class:"label"},"上传时间:",-1)),e("span",Hs,C(c(H)(h.file.created_at)),1)])])])])):h.file.file_type==="video"?(m(),F("div",et,[a(Is,{video:h.file,onClose:p[0]||(p[0]=W=>b.$emit("close")),onLoad:P,onError:g},null,8,["video"])])):(m(),F("div",st,[a(T,{class:"unknown-icon"},{default:r(()=>[a(c(Me))]),_:1}),p[5]||(p[5]=e("h3",null,"不支持的文件类型",-1)),p[6]||(p[6]=e("p",null,"无法预览此类型的文件",-1))])),e("div",tt,[a(B,{type:"primary",onClick:k},{default:r(()=>[a(T,null,{default:r(()=>[a(c(fe))]),_:1}),p[7]||(p[7]=z(" 下载 ",-1))]),_:1}),a(B,{onClick:x},{default:r(()=>[a(T,null,{default:r(()=>[a(c(pe))]),_:1}),p[8]||(p[8]=z(" 复制链接 ",-1))]),_:1}),a(B,{type:"danger",onClick:M},{default:r(()=>[a(T,null,{default:r(()=>[a(c(Ve))]),_:1}),p[9]||(p[9]=z(" 删除 ",-1))]),_:1})])])}}}),_t=oe(at,[["__scopeId","data-v-a9813a64"]]);export{_t as F,mt as a,he as u};
