import{_ as je}from"./_plugin-vue_export-helper-BwE83l92.js";/* empty css                   *//* empty css                *//* empty css                 *//* empty css                    *//* empty css                  */import{y as qe,r as y,c as $,j as Je,z as p,B as e,R as t,J as o,u as a,P as n,I as C,L as Ce,E as f,A as r,O as v,Q as N,a6 as F,D as Se,al as Oe,aC as We}from"./vendor-BcB6VvZI.js";import{G as Ge,c as He,b as Qe,y as Xe,Z as Ze,ac as xe,j as Ne,a4 as Fe,O as De,p as Ue,ad as S,X as Ee,q as Ke,ae as Ye,J as es,af as ss,ag as ts,ah as as,a5 as os,a0 as ls,$ as ns,ai as is,W as ds,E as M}from"./element-_v7tGFXC.js";import{u as cs,a as Ve}from"./index-CbGLUEpg.js";import{u as rs,a as us,F as _s}from"./FilePreview-Ql3VAuDc.js";import{f as m,b as w,g as vs}from"./helpers-iwoUo1o7.js";/* empty css               *//* empty css                  *//* empty css                 *//* empty css                        *//* empty css                  */const gs={class:"dashboard"},ps={class:"welcome-section"},ms={class:"welcome-main"},fs={class:"welcome-header"},hs={class:"user-avatar"},bs={class:"welcome-text"},ws={class:"welcome-title"},zs={class:"welcome-subtitle"},ks={class:"welcome-actions"},ys={class:"welcome-stats"},Cs={class:"stat-item"},Ss={class:"stat-value"},xs={class:"stat-item"},Ns={class:"stat-value"},Fs={class:"stat-item"},Ds={class:"stat-value"},Us={class:"stats-grid"},Es={class:"stat-card image-card"},Vs={class:"card-header"},Bs={class:"stat-icon"},$s={class:"stat-trend"},Ms={class:"stat-content"},Ts={class:"stat-number"},As={class:"stat-detail"},Ps={class:"stat-card video-card"},Is={class:"card-header"},Ls={class:"stat-icon"},Rs={class:"stat-trend"},js={class:"stat-content"},qs={class:"stat-number"},Js={class:"stat-detail"},Os={class:"stat-card folder-card"},Ws={class:"card-header"},Gs={class:"stat-icon"},Hs={class:"stat-trend"},Qs={class:"stat-content"},Xs={class:"stat-number"},Zs={class:"stat-detail"},Ks={class:"stat-card storage-card"},Ys={class:"card-header"},et={class:"stat-icon"},st={class:"stat-trend"},tt={class:"stat-content"},at={class:"stat-number"},ot={class:"stat-detail"},lt={class:"main-content"},nt={class:"storage-section"},it={class:"card-header"},dt={class:"header-left"},ct={class:"header-actions"},rt={class:"storage-content"},ut={class:"storage-overview"},_t={class:"storage-info"},vt={class:"storage-text"},gt={class:"used"},pt={class:"total"},mt={class:"storage-percent"},ft={class:"storage-breakdown"},ht={class:"breakdown-item"},bt={class:"breakdown-icon image"},wt={class:"breakdown-content"},zt={class:"breakdown-value"},kt={class:"breakdown-item"},yt={class:"breakdown-icon video"},Ct={class:"breakdown-content"},St={class:"breakdown-value"},xt={class:"storage-tips"},Nt={class:"trend-section"},Ft={class:"card-header"},Dt={class:"header-left"},Ut={class:"header-actions"},Et={key:0,class:"trend-charts"},Vt={class:"chart-container"},Bt={class:"chart-content"},$t={class:"chart-bars"},Mt=["title"],Tt={class:"bar-value"},At={class:"chart-labels"},Pt={class:"chart-container"},It={class:"chart-content"},Lt={class:"chart-bars"},Rt=["title"],jt={class:"bar-value"},qt={class:"chart-labels"},Jt={key:1,class:"empty-state"},Ot={class:"quick-actions"},Wt={class:"card-header"},Gt={class:"header-left"},Ht={class:"actions-grid"},Qt={class:"action-icon"},Xt={class:"action-icon"},Zt={class:"action-icon"},Kt={class:"action-icon"},Yt={class:"action-icon"},ea={class:"action-icon"},sa=qe({__name:"Dashboard",setup(ta){const T=We(),u=cs(),A=rs(),z=y(!1),D=y(!1),P=y(null),U=y(!1),l=y({imageCount:0,videoCount:0,folderCount:0,totalFiles:0,totalSize:0,imageSize:0,videoSize:0,changes:{files:{value:0,percentage:0},size:{value:0,percentage:0},images:{value:0,percentage:0},videos:{value:0,percentage:0},folders:{value:0,percentage:0}},trends:[]}),Be=$(()=>new Date().toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric",weekday:"long"}));$(()=>A.files.slice(0,6));const E=$(()=>window.innerWidth<=768),$e=c=>vs(c),h=()=>{T.push("/")},Me=()=>{T.push("/admin")},I=async()=>{try{const{value:c}=await ds.prompt("请输入文件夹名称","新建文件夹",{confirmButtonText:"创建",cancelButtonText:"取消",inputPattern:/^.{1,50}$/,inputErrorMessage:"文件夹名称长度应在1-50个字符之间"});c&&(await A.createFolder(c),M.success("文件夹创建成功"))}catch{}},Te=()=>{z.value=!1,k()},Ae=c=>{D.value=!1,k()},k=async()=>{try{const s=(await Ve.get("/files/stats")).data.data;l.value={imageCount:s.image_count||0,videoCount:s.video_count||0,folderCount:s.folder_count||0,totalFiles:s.total_files||0,totalSize:s.total_size||0,imageSize:s.image_size||0,videoSize:s.video_size||0,changes:s.changes||{files:{value:0,percentage:0},size:{value:0,percentage:0},images:{value:0,percentage:0},videos:{value:0,percentage:0},folders:{value:0,percentage:0}},trends:s.trends||[]}}catch{await Pe()}},Pe=async()=>{try{const s=(await Ve.get("/files/stats")).data.data;l.value={imageCount:s.image_count||0,videoCount:s.video_count||0,folderCount:s.folder_count||0,totalFiles:s.total_files||0,totalSize:s.total_size||0,imageSize:s.image_size||0,videoSize:s.video_size||0,changes:s.changes||{files:{value:0,percentage:0},size:{value:0,percentage:0},images:{value:0,percentage:0},videos:{value:0,percentage:0},folders:{value:0,percentage:0}},trends:s.trends||[]}}catch{l.value={imageCount:0,videoCount:0,folderCount:0,totalFiles:0,totalSize:0,imageSize:0,videoSize:0,changes:{files:{value:0,percentage:0},size:{value:0,percentage:0},images:{value:0,percentage:0},videos:{value:0,percentage:0},folders:{value:0,percentage:0}},trends:[]}}},Ie=async()=>{U.value=!0;try{await k(),M.success("趋势数据已刷新")}catch{M.error("刷新趋势数据失败")}finally{U.value=!1}},L=(c,s)=>{if(!l.value.trends.length)return 0;const b=l.value.trends.map(x=>s==="files"?x.total_files:s==="size"?x.total_size:0),i=Math.max(...b),g=Math.min(...b);return i===g?50:Math.max(10,(c-g)/(i-g)*80+10)},R=c=>{const s=new Date(c),b=s.getMonth()+1,i=s.getDate();return`${b}/${i}`};return Je(()=>{k()}),(c,s)=>{var J,O,W,G,H,Q,X,Z,K,Y,ee,se,te,ae,oe,le,ne,ie,de,ce,re,ue,_e,ve,ge,pe,me,fe,he,be,we,ze,ke,ye;const b=Ge,i=Qe,g=He,x=es,V=ss,B=Xe,j=Oe("Refresh"),Le=as,q=Ze;return r(),p("div",gs,[e("div",ps,[e("div",ms,[e("div",fs,[e("div",hs,[t(b,{size:60,src:(J=a(u).user)==null?void 0:J.avatar_url},{default:o(()=>{var d,_;return[v(n((_=(d=a(u).user)==null?void 0:d.username)==null?void 0:_.charAt(0).toUpperCase()),1)]}),_:1},8,["src"])]),e("div",bs,[e("h1",ws," 欢迎回来，"+n((O=a(u).user)==null?void 0:O.username)+"！ ",1),e("p",zs," 今天是 "+n(Be.value)+"，让我们开始管理您的文件吧 ",1)])]),e("div",ks,[t(g,{type:"primary",size:"large",onClick:h,class:"action-btn primary"},{default:o(()=>[t(i,null,{default:o(()=>[t(a(xe))]),_:1}),s[4]||(s[4]=v(" 浏览文件 ",-1))]),_:1}),t(g,{size:"large",onClick:s[0]||(s[0]=d=>z.value=!0),class:"action-btn"},{default:o(()=>[t(i,null,{default:o(()=>[t(a(Ne))]),_:1}),s[5]||(s[5]=v(" 上传文件 ",-1))]),_:1}),t(g,{size:"large",onClick:I,class:"action-btn"},{default:o(()=>[t(i,null,{default:o(()=>[t(a(Fe))]),_:1}),s[6]||(s[6]=v(" 新建文件夹 ",-1))]),_:1}),a(u).isAdmin?(r(),C(g,{key:0,size:"large",onClick:Me,class:"action-btn admin-btn"},{default:o(()=>[t(i,null,{default:o(()=>[t(a(De))]),_:1}),s[7]||(s[7]=v(" 管理控制台 ",-1))]),_:1})):Ce("",!0)])]),e("div",ys,[e("div",Cs,[e("span",Ss,n(l.value.totalFiles),1),s[8]||(s[8]=e("span",{class:"stat-label"},"总文件数",-1))]),e("div",xs,[e("span",Ns,n(a(m)(l.value.totalSize)),1),s[9]||(s[9]=e("span",{class:"stat-label"},"已使用空间",-1))]),e("div",Fs,[e("span",Ds,n(a(w)(a(u).storageUsage)),1),s[10]||(s[10]=e("span",{class:"stat-label"},"使用率",-1))])])]),e("div",Us,[e("div",Es,[e("div",Vs,[e("div",Bs,[t(i,null,{default:o(()=>[t(a(Ue))]),_:1})]),e("div",$s,[t(i,{class:f((Number((G=(W=l.value.changes)==null?void 0:W.images)==null?void 0:G.percentage)||0)>=0?"trend-up":"trend-down")},{default:o(()=>[t(a(S))]),_:1},8,["class"]),e("span",{class:f(["trend-text",(Number((Q=(H=l.value.changes)==null?void 0:H.images)==null?void 0:Q.percentage)||0)>=0?"trend-positive":"trend-negative"])},n((Number((Z=(X=l.value.changes)==null?void 0:X.images)==null?void 0:Z.percentage)||0)>=0?"+":"")+n((Number((Y=(K=l.value.changes)==null?void 0:K.images)==null?void 0:Y.percentage)||0).toFixed(1))+"% ",3)])]),e("div",Ms,[e("div",Ts,n(l.value.imageCount),1),s[11]||(s[11]=e("div",{class:"stat-label"},"图片文件",-1)),e("div",As,n(a(m)(l.value.imageSize)),1)])]),e("div",Ps,[e("div",Is,[e("div",Ls,[t(i,null,{default:o(()=>[t(a(Ee))]),_:1})]),e("div",Rs,[t(i,{class:f((Number((se=(ee=l.value.changes)==null?void 0:ee.videos)==null?void 0:se.percentage)||0)>=0?"trend-up":"trend-down")},{default:o(()=>[t(a(S))]),_:1},8,["class"]),e("span",{class:f(["trend-text",(Number((ae=(te=l.value.changes)==null?void 0:te.videos)==null?void 0:ae.percentage)||0)>=0?"trend-positive":"trend-negative"])},n((Number((le=(oe=l.value.changes)==null?void 0:oe.videos)==null?void 0:le.percentage)||0)>=0?"+":"")+n((Number((ie=(ne=l.value.changes)==null?void 0:ne.videos)==null?void 0:ie.percentage)||0).toFixed(1))+"% ",3)])]),e("div",js,[e("div",qs,n(l.value.videoCount),1),s[12]||(s[12]=e("div",{class:"stat-label"},"视频文件",-1)),e("div",Js,n(a(m)(l.value.videoSize)),1)])]),e("div",Os,[e("div",Ws,[e("div",Gs,[t(i,null,{default:o(()=>[t(a(Ke))]),_:1})]),e("div",Hs,[t(i,{class:f((Number((ce=(de=l.value.changes)==null?void 0:de.folders)==null?void 0:ce.percentage)||0)>=0?"trend-up":"trend-down")},{default:o(()=>[t(a(S))]),_:1},8,["class"]),e("span",{class:f(["trend-text",(Number((ue=(re=l.value.changes)==null?void 0:re.folders)==null?void 0:ue.percentage)||0)>=0?"trend-positive":"trend-negative"])},n((Number((ve=(_e=l.value.changes)==null?void 0:_e.folders)==null?void 0:ve.percentage)||0)>=0?"+":"")+n((Number((pe=(ge=l.value.changes)==null?void 0:ge.folders)==null?void 0:pe.percentage)||0).toFixed(1))+"% ",3)])]),e("div",Qs,[e("div",Xs,n(l.value.folderCount),1),s[13]||(s[13]=e("div",{class:"stat-label"},"文件夹",-1)),e("div",Zs,n(l.value.totalFiles)+" 个文件",1)])]),e("div",Ks,[e("div",Ys,[e("div",et,[t(i,null,{default:o(()=>[t(a(Ye))]),_:1})]),e("div",st,[t(i,{class:f((Number((fe=(me=l.value.changes)==null?void 0:me.size)==null?void 0:fe.percentage)||0)>=0?"trend-up":"trend-down")},{default:o(()=>[t(a(S))]),_:1},8,["class"]),e("span",{class:f(["trend-text",(Number((be=(he=l.value.changes)==null?void 0:he.size)==null?void 0:be.percentage)||0)>=0?"trend-positive":"trend-negative"])},n((Number((ze=(we=l.value.changes)==null?void 0:we.size)==null?void 0:ze.percentage)||0)>=0?"+":"")+n((Number((ye=(ke=l.value.changes)==null?void 0:ke.size)==null?void 0:ye.percentage)||0).toFixed(1))+"% ",3)])]),e("div",tt,[e("div",at,n(a(m)(l.value.totalSize)),1),s[14]||(s[14]=e("div",{class:"stat-label"},"总大小",-1)),e("div",ot,n(a(w)(a(u).storageUsage))+" 使用率",1)])])]),e("div",lt,[e("div",nt,[t(B,{class:"storage-card"},{header:o(()=>[e("div",it,[e("div",dt,[t(i,{class:"header-icon"},{default:o(()=>[t(a(ts))]),_:1}),s[15]||(s[15]=e("h3",null,"存储使用情况",-1))]),e("div",ct,[t(g,{type:"text",onClick:h},{default:o(()=>[t(i,null,{default:o(()=>[t(a(De))]),_:1}),s[16]||(s[16]=v(" 管理文件 ",-1))]),_:1})])])]),default:o(()=>{var d,_;return[e("div",rt,[e("div",ut,[e("div",_t,[e("div",vt,[e("span",gt,n(a(m)(((d=a(u).user)==null?void 0:d.used_storage)||0)),1),s[17]||(s[17]=e("span",{class:"separator"},"/",-1)),e("span",pt,n(a(m)(((_=a(u).user)==null?void 0:_.storage_limit)||0)),1)]),e("div",mt,n(a(w)(a(u).storageUsage))+" 已使用 ",1)]),t(x,{percentage:a(u).storageUsage,color:$e(a(u).storageUsage),"stroke-width":16,class:"storage-progress"},{default:o(({percentage:Re})=>[v(n(a(w)(Re)),1)]),_:1},8,["percentage","color"])]),e("div",ft,[e("div",ht,[e("div",bt,[t(i,null,{default:o(()=>[t(a(Ue))]),_:1})]),e("div",wt,[s[18]||(s[18]=e("div",{class:"breakdown-label"},"图片文件",-1)),e("div",zt,n(a(m)(l.value.imageSize)),1)])]),e("div",kt,[e("div",yt,[t(i,null,{default:o(()=>[t(a(Ee))]),_:1})]),e("div",Ct,[s[19]||(s[19]=e("div",{class:"breakdown-label"},"视频文件",-1)),e("div",St,n(a(m)(l.value.videoSize)),1)])])]),e("div",xt,[a(u).storageUsage>90?(r(),C(V,{key:0,title:"存储空间不足",type:"warning",closable:!1,"show-icon":""},{default:o(()=>[...s[20]||(s[20]=[v(" 您的存储空间即将用完，请及时清理不需要的文件或联系管理员扩容 ",-1)])]),_:1})):a(u).storageUsage>70?(r(),C(V,{key:1,title:"存储空间提醒",type:"info",closable:!1,"show-icon":""},{default:o(()=>[v(" 您的存储空间已使用 "+n(a(w)(a(u).storageUsage))+"，建议定期清理文件 ",1)]),_:1})):(r(),C(V,{key:2,title:"存储空间充足",type:"success",closable:!1,"show-icon":""},{default:o(()=>[v(" 您的存储空间使用正常，还有 "+n(a(w)(100-a(u).storageUsage))+" 可用空间 ",1)]),_:1}))])])]}),_:1})]),e("div",Nt,[t(B,{class:"trend-card"},{header:o(()=>[e("div",Ft,[e("div",Dt,[t(i,{class:"header-icon"},{default:o(()=>[t(a(S))]),_:1}),s[21]||(s[21]=e("h3",null,"趋势分析",-1))]),e("div",Ut,[t(g,{type:"text",onClick:Ie,loading:U.value},{default:o(()=>[t(i,null,{default:o(()=>[t(j)]),_:1}),s[22]||(s[22]=v(" 刷新数据 ",-1))]),_:1},8,["loading"])])])]),default:o(()=>[l.value.trends.length>0?(r(),p("div",Et,[e("div",Vt,[s[23]||(s[23]=e("div",{class:"chart-title"},"文件数量趋势",-1)),e("div",Bt,[e("div",$t,[(r(!0),p(N,null,F(l.value.trends,(d,_)=>(r(),p("div",{key:_,class:"chart-bar",style:Se({height:L(d.total_files,"files")+"%"}),title:`${d.trend_date}: ${d.total_files} 个文件`},[e("span",Tt,n(d.total_files),1)],12,Mt))),128))]),e("div",At,[(r(!0),p(N,null,F(l.value.trends,(d,_)=>(r(),p("span",{key:_,class:"chart-label"},n(R(d.trend_date)),1))),128))])])]),e("div",Pt,[s[24]||(s[24]=e("div",{class:"chart-title"},"存储使用趋势",-1)),e("div",It,[e("div",Lt,[(r(!0),p(N,null,F(l.value.trends,(d,_)=>(r(),p("div",{key:_,class:"chart-bar storage-bar",style:Se({height:L(d.total_size,"size")+"%"}),title:`${d.trend_date}: ${a(m)(d.total_size)}`},[e("span",jt,n(a(m)(d.total_size)),1)],12,Rt))),128))]),e("div",qt,[(r(!0),p(N,null,F(l.value.trends,(d,_)=>(r(),p("span",{key:_,class:"chart-label"},n(R(d.trend_date)),1))),128))])])])])):(r(),p("div",Jt,[t(Le,{description:"暂无趋势数据"},{default:o(()=>[t(g,{type:"primary",onClick:k},{default:o(()=>[t(i,null,{default:o(()=>[t(j)]),_:1}),s[25]||(s[25]=v(" 刷新数据 ",-1))]),_:1})]),_:1})]))]),_:1})])]),e("div",Ot,[t(B,{class:"actions-card"},{header:o(()=>[e("div",Wt,[e("div",Gt,[t(i,{class:"header-icon"},{default:o(()=>[t(a(is))]),_:1}),s[26]||(s[26]=e("h3",null,"快速操作",-1))])])]),default:o(()=>[e("div",Ht,[e("div",{class:"action-item",onClick:s[1]||(s[1]=d=>z.value=!0)},[e("div",Qt,[t(i,null,{default:o(()=>[t(a(Ne))]),_:1})]),s[27]||(s[27]=e("div",{class:"action-content"},[e("span",{class:"action-text"},"上传文件"),e("span",{class:"action-desc"},"拖拽或点击上传")],-1))]),e("div",{class:"action-item",onClick:h},[e("div",Xt,[t(i,null,{default:o(()=>[t(a(xe))]),_:1})]),s[28]||(s[28]=e("div",{class:"action-content"},[e("span",{class:"action-text"},"浏览文件"),e("span",{class:"action-desc"},"查看所有文件")],-1))]),e("div",{class:"action-item",onClick:I},[e("div",Zt,[t(i,null,{default:o(()=>[t(a(Fe))]),_:1})]),s[29]||(s[29]=e("div",{class:"action-content"},[e("span",{class:"action-text"},"新建文件夹"),e("span",{class:"action-desc"},"整理您的文件")],-1))]),e("div",{class:"action-item",onClick:h},[e("div",Kt,[t(i,null,{default:o(()=>[t(a(os))]),_:1})]),s[30]||(s[30]=e("div",{class:"action-content"},[e("span",{class:"action-text"},"搜索文件"),e("span",{class:"action-desc"},"快速查找文件")],-1))]),e("div",{class:"action-item",onClick:h},[e("div",Yt,[t(i,null,{default:o(()=>[t(a(ls))]),_:1})]),s[31]||(s[31]=e("div",{class:"action-content"},[e("span",{class:"action-text"},"分享文件"),e("span",{class:"action-desc"},"生成分享链接")],-1))]),e("div",{class:"action-item",onClick:h},[e("div",ea,[t(i,null,{default:o(()=>[t(a(ns))]),_:1})]),s[32]||(s[32]=e("div",{class:"action-content"},[e("span",{class:"action-text"},"批量下载"),e("span",{class:"action-desc"},"下载多个文件")],-1))])])]),_:1})]),t(q,{modelValue:z.value,"onUpdate:modelValue":s[2]||(s[2]=d=>z.value=d),title:"上传文件",width:E.value?"95%":"600px","close-on-click-modal":!1,class:f({"mobile-upload-dialog":E.value}),"modal-class":E.value?"mobile-modal":""},{default:o(()=>[t(us,{onUploadSuccess:Te})]),_:1},8,["modelValue","width","class","modal-class"]),t(q,{modelValue:D.value,"onUpdate:modelValue":s[3]||(s[3]=d=>D.value=d),title:"文件预览",width:"80%","close-on-click-modal":!0},{default:o(()=>[P.value?(r(),C(_s,{key:0,file:P.value,onFileDeleted:Ae},null,8,["file"])):Ce("",!0)]),_:1},8,["modelValue"])])}}}),ba=je(sa,[["__scopeId","data-v-11c238f7"]]);export{ba as default};
