import{_ as h}from"./_plugin-vue_export-helper-BwE83l92.js";import{y,r as i,j as w,aC as b,z as l,B as o,L as S,R as e,J as c,P as C,A as r,u as d,O as E}from"./vendor-BcB6VvZI.js";import{E as x,b as B,c as N,k as q,m as I,n as V}from"./element-BdwomdJ_.js";import{u as L,a as P}from"./index-t7Yr4nUA.js";const R={class:"qq-callback-container"},T={class:"callback-content"},A={key:0,class:"loading-spinner"},J={key:1,class:"error-message"},M={key:2,class:"success-message"},O=y({__name:"QQCallback",setup(j){const _=b(),m=L(),p=i(!0),u=i(""),f=i(!1);w(async()=>{try{const t=new URLSearchParams(window.location.search),s=t.get("code"),n=t.get("state");if(!s)throw new Error("授权码缺失");const a=await P.post("/auth/qq/callback",{code:s});if(a.data.success){const{token:g,user:v,settings:k}=a.data;m.token=g,m.user=v,localStorage.setItem("token",g),k&&localStorage.setItem("userSettings",JSON.stringify(k)),f.value=!0,x.success("QQ登录成功！"),setTimeout(()=>{_.push("/")},1500)}else throw new Error(a.data.message||"QQ登录失败")}catch(t){u.value=t.message||"QQ登录失败，请重试",p.value=!1}});const Q=()=>{_.push("/login")};return(t,s)=>{const n=B,a=N;return r(),l("div",R,[o("div",T,[p.value?(r(),l("div",A,[e(n,{class:"is-loading"},{default:c(()=>[e(d(q))]),_:1}),s[0]||(s[0]=o("p",null,"正在处理QQ登录...",-1))])):u.value?(r(),l("div",J,[e(n,{class:"error-icon"},{default:c(()=>[e(d(I))]),_:1}),o("p",null,C(u.value),1),e(a,{type:"primary",onClick:Q},{default:c(()=>[...s[1]||(s[1]=[E("返回登录",-1)])]),_:1})])):f.value?(r(),l("div",M,[e(n,{class:"success-icon"},{default:c(()=>[e(d(V))]),_:1}),s[2]||(s[2]=o("p",null,"QQ登录成功！",-1)),s[3]||(s[3]=o("p",null,"正在跳转...",-1))])):S("",!0)])])}}}),G=h(O,[["__scopeId","data-v-680bdfdd"]]);export{G as default};
