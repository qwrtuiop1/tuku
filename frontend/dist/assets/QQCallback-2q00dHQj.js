import{_ as h}from"./_plugin-vue_export-helper-BwE83l92.js";import{y,r as i,j as w,aC as S,z as l,B as o,L as b,R as s,J as r,P as C,A as c,u as d,O as E}from"./vendor-BcB6VvZI.js";import{E as x,b as B,c as I,k as N,m as q,n as V}from"./element-CCVRQ6po.js";import{u as L,a as M}from"./index-z_UOtP8j.js";const P={class:"qq-callback-container"},R={class:"callback-content"},T={key:0,class:"loading-spinner"},A={key:1,class:"error-message"},J={key:2,class:"success-message"},O=y({__name:"QQCallback",setup(j){const _=S(),m=L(),p=i(!0),u=i(""),f=i(!1);w(async()=>{try{const t=new URLSearchParams(window.location.search),e=t.get("code"),n=t.get("state");if(!e)throw new Error("授权码缺失");const a=await M.post("/auth/qq/callback",{code:e});if(a.data.success){const{token:g,user:v,settings:k}=a.data;m.token=g,m.user=v,localStorage.setItem("token",g),localStorage.setItem("rememberMe","true"),k&&localStorage.setItem("userSettings",JSON.stringify(k)),f.value=!0,x.success("QQ登录成功！"),setTimeout(()=>{_.push("/")},1500)}else throw new Error(a.data.message||"QQ登录失败")}catch(t){u.value=t.message||"QQ登录失败，请重试",p.value=!1}});const Q=()=>{_.push("/login")};return(t,e)=>{const n=B,a=I;return c(),l("div",P,[o("div",R,[p.value?(c(),l("div",T,[s(n,{class:"is-loading"},{default:r(()=>[s(d(N))]),_:1}),e[0]||(e[0]=o("p",null,"正在处理QQ登录...",-1))])):u.value?(c(),l("div",A,[s(n,{class:"error-icon"},{default:r(()=>[s(d(q))]),_:1}),o("p",null,C(u.value),1),s(a,{type:"primary",onClick:Q},{default:r(()=>[...e[1]||(e[1]=[E("返回登录",-1)])]),_:1})])):f.value?(c(),l("div",J,[s(n,{class:"success-icon"},{default:r(()=>[s(d(V))]),_:1}),e[2]||(e[2]=o("p",null,"QQ登录成功！",-1)),e[3]||(e[3]=o("p",null,"正在跳转...",-1))])):b("",!0)])])}}}),G=h(O,[["__scopeId","data-v-9ce16c25"]]);export{G as default};
