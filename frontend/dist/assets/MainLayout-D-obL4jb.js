import{_ as me}from"./_plugin-vue_export-helper-BwE83l92.js";/* empty css                  *//* empty css                    *//* empty css                           *//* empty css                         *//* empty css                     *//* empty css                  *//* empty css                     */import{y as pe,r as y,c as K,aD as ve,w as fe,j as _e,U as ge,z as h,L as m,B as o,I as v,J as t,R as e,E as f,u as s,P as _,al as he,A as d,O as p,Q as be,a6 as ke,T as we,M as ye,aC as Ee}from"./vendor-BcB6VvZI.js";import{F as Ce,G as Me,H as xe,I as Se,J as Le,K as Ue,b as $e,c as Ae,L as Be,M as Te,q as Z,N as ee,O as C,g as M,P as ze,Q as Xe,R as De,S as z,T as Ie,U as Ne,V as Re,W as Ve,E as Ye}from"./element-_v7tGFXC.js";import{u as Pe}from"./index-CbGLUEpg.js";import{f as te,b as Fe,g as qe}from"./helpers-iwoUo1o7.js";const Je="/logo.png",Oe={class:"main-layout"},Qe={class:"sidebar-header"},We={key:0,class:"logo-text"},je={class:"sidebar-nav"},Ge={key:0,class:"user-details"},He={class:"username"},Ke={class:"user-role"},Ze={class:"top-header"},et={class:"header-left"},tt={class:"header-right"},at={class:"storage-text"},st={key:0,class:"mobile-storage"},ot={class:"desktop-user-info"},lt={class:"user-details"},nt={class:"username"},ut={class:"user-role"},rt={class:"page-content"},dt={key:0,class:"page-wrapper"},it={key:1,class:"mobile-bottom-nav"},ct={class:"nav-items"},mt=pe({__name:"MainLayout",setup(pt){const x=ve(),U=Ee(),u=Pe(),r=y(!1),c=y(!1),S=y(0),X=y(0),L=y(!1);y(!1);const D=()=>{const l=window.innerWidth;c.value=l<768,l<768||l<1024?r.value=!0:r.value=!1},ae=K(()=>x.path),se=K(()=>{const l={"/":{name:"文件管理",path:"/"},"/dashboard":{name:"仪表盘",path:"/dashboard"},"/admin":{name:"管理控制台",path:"/admin"},"/profile":{name:"个人资料",path:"/profile"},"/settings":{name:"系统设置",path:"/settings"},"/user-center":{name:"个人设置",path:"/user-center"}};return l[x.path]?[l[x.path]]:[]}),I=()=>{r.value=!r.value},oe=()=>{r.value&&(r.value=!1)},le=()=>{c.value&&(r.value=!0)},N=l=>qe(l),ne=()=>{c.value&&(r.value=!0)},$=async l=>{switch(l){case"profile":U.push("/profile");break;case"settings":u.isAdmin?U.push("/settings"):Ye.warning("需要管理员权限");break;case"logout":try{await Ve.confirm("确定要退出登录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),u.logout(),U.push("/login")}catch{}break}},R=l=>{c.value&&(S.value=l.touches[0].clientX,X.value=l.touches[0].clientY,L.value=!1)},V=l=>{if(!c.value)return;const a=l.touches[0].clientX,n=l.touches[0].clientY,k=a-S.value,w=n-X.value;Math.abs(k)>Math.abs(w)&&Math.abs(k)>10&&(L.value=!0)},Y=l=>{if(!c.value||!L.value)return;const n=l.changedTouches[0].clientX-S.value;n>50&&S.value<20?r.value=!1:n<-50&&r.value===!1&&(r.value=!0),L.value=!1};fe(x,()=>{},{immediate:!0});const P=()=>{D()};return _e(()=>{D(),window.addEventListener("resize",P),c.value&&(document.addEventListener("touchstart",R,{passive:!0}),document.addEventListener("touchmove",V,{passive:!0}),document.addEventListener("touchend",Y,{passive:!0}))}),ge(()=>{window.removeEventListener("resize",P),c.value&&(document.removeEventListener("touchstart",R),document.removeEventListener("touchmove",V),document.removeEventListener("touchend",Y))}),(l,a)=>{var q,J,O,Q,W,j;const n=$e,k=Ae,w=Te,ue=Ce,A=Me,g=De,B=Xe,T=xe,re=Ne,de=Se,F=Le,ie=Ue,ce=he("router-view");return d(),h("div",Oe,[c.value&&!r.value?(d(),h("div",{key:0,class:"mobile-overlay",onClick:le})):m("",!0),o("aside",{class:f(["sidebar",{collapsed:r.value,"mobile-sidebar":c.value,"mobile-open":c.value&&!r.value}])},[o("div",Qe,[o("div",{class:"logo",onClick:oe},[a[4]||(a[4]=o("img",{src:Je,alt:"图库系统",class:"logo-image"},null,-1)),r.value?m("",!0):(d(),h("span",We,"图库系统"))]),r.value?m("",!0):(d(),v(k,{key:0,type:"text",class:"collapse-btn",onClick:I},{default:t(()=>[e(n,null,{default:t(()=>[e(s(Be))]),_:1})]),_:1}))]),o("nav",je,[e(ue,{"default-active":ae.value,collapse:r.value,"unique-opened":!0,router:"",onSelect:ne},{default:t(()=>[e(w,{index:"/"},{default:t(()=>[e(n,null,{default:t(()=>[e(s(Z))]),_:1}),a[5]||(a[5]=o("span",null,"文件管理",-1))]),_:1}),e(w,{index:"/dashboard"},{default:t(()=>[e(n,null,{default:t(()=>[e(s(ee))]),_:1}),a[6]||(a[6]=o("span",null,"仪表盘",-1))]),_:1}),s(u).isAdmin?(d(),v(w,{key:0,index:"/admin"},{default:t(()=>[e(n,null,{default:t(()=>[e(s(C))]),_:1}),a[7]||(a[7]=o("span",null,"管理中心",-1))]),_:1})):m("",!0),s(u).isAdmin?m("",!0):(d(),v(w,{key:1,index:"/user-center"},{default:t(()=>[e(n,null,{default:t(()=>[e(s(M))]),_:1}),a[8]||(a[8]=o("span",null,"个人设置",-1))]),_:1}))]),_:1},8,["default-active","collapse"])]),o("div",{class:f(["sidebar-footer",{collapsed:r.value}])},[o("div",{class:f(["user-info",{collapsed:r.value}])},[e(A,{size:32,src:(q=s(u).user)==null?void 0:q.avatar_url},{default:t(()=>{var i,b;return[p(_((b=(i=s(u).user)==null?void 0:i.username)==null?void 0:b.charAt(0).toUpperCase()),1)]}),_:1},8,["src"]),r.value?m("",!0):(d(),h("div",Ge,[o("div",He,_((J=s(u).user)==null?void 0:J.username),1),o("div",Ke,_(((O=s(u).user)==null?void 0:O.role)==="admin"?"管理员":"用户"),1)]))],2),e(T,{onCommand:$,placement:"top-end"},{dropdown:t(()=>[e(B,null,{default:t(()=>[e(g,{command:"profile"},{default:t(()=>[e(n,null,{default:t(()=>[e(s(M))]),_:1}),a[9]||(a[9]=p(" 个人资料 ",-1))]),_:1}),s(u).isAdmin?(d(),v(g,{key:0,command:"settings"},{default:t(()=>[e(n,null,{default:t(()=>[e(s(C))]),_:1}),a[10]||(a[10]=p(" 设置 ",-1))]),_:1})):m("",!0),e(g,{divided:"",command:"logout"},{default:t(()=>[e(n,null,{default:t(()=>[e(s(z))]),_:1}),a[11]||(a[11]=p(" 退出登录 ",-1))]),_:1})]),_:1})]),default:t(()=>[e(k,{type:"text",class:f(["user-menu-btn",{collapsed:r.value}])},{default:t(()=>[e(n,null,{default:t(()=>[e(s(ze))]),_:1})]),_:1},8,["class"])]),_:1})],2)],2),o("div",{class:f(["main-content",{"sidebar-collapsed":r.value}])},[o("header",Ze,[o("div",et,[c.value?(d(),v(k,{key:0,type:"text",class:"mobile-menu-btn",onClick:I},{default:t(()=>[e(n,null,{default:t(()=>[e(s(Ie))]),_:1})]),_:1})):m("",!0),e(de,{separator:"/",class:"breadcrumb-nav"},{default:t(()=>[(d(!0),h(be,null,ke(se.value,i=>(d(),v(re,{key:i.path,to:i.path},{default:t(()=>[p(_(i.name),1)]),_:2},1032,["to"]))),128))]),_:1})]),o("div",tt,[o("div",{class:f(["storage-info",{"mobile-hidden":c.value}])},[e(F,{percentage:s(u).storageUsage,color:N(s(u).storageUsage),"stroke-width":6,"show-text":!1,class:"storage-progress"},null,8,["percentage","color"]),o("span",at,_(s(te)(((Q=s(u).user)==null?void 0:Q.used_storage)||0))+" / "+_(s(te)(((W=s(u).user)==null?void 0:W.storage_limit)||0)),1)],2),c.value?(d(),h("div",st,[e(ie,{content:`存储使用: ${s(Fe)(s(u).storageUsage)}`,placement:"bottom"},{default:t(()=>[e(F,{percentage:s(u).storageUsage,color:N(s(u).storageUsage),"stroke-width":12,"show-text":!1,class:"mobile-storage-progress"},null,8,["percentage","color"])]),_:1},8,["content"])])):m("",!0),c.value?m("",!0):(d(),v(T,{key:1,onCommand:$,placement:"bottom-end"},{dropdown:t(()=>[e(B,null,{default:t(()=>[e(g,{command:"profile"},{default:t(()=>[e(n,null,{default:t(()=>[e(s(M))]),_:1}),a[12]||(a[12]=p(" 个人资料 ",-1))]),_:1}),s(u).isAdmin?(d(),v(g,{key:0,command:"settings"},{default:t(()=>[e(n,null,{default:t(()=>[e(s(C))]),_:1}),a[13]||(a[13]=p(" 设置 ",-1))]),_:1})):m("",!0),e(g,{divided:"",command:"logout"},{default:t(()=>[e(n,null,{default:t(()=>[e(s(z))]),_:1}),a[14]||(a[14]=p(" 退出登录 ",-1))]),_:1})]),_:1})]),default:t(()=>{var i,b,E;return[o("div",ot,[e(A,{size:32,src:(i=s(u).user)==null?void 0:i.avatar_url},{default:t(()=>{var G,H;return[p(_((H=(G=s(u).user)==null?void 0:G.username)==null?void 0:H.charAt(0).toUpperCase()),1)]}),_:1},8,["src"]),o("div",lt,[o("div",nt,_((b=s(u).user)==null?void 0:b.username),1),o("div",ut,_(((E=s(u).user)==null?void 0:E.role)==="admin"?"管理员":"用户"),1)]),e(n,{class:"dropdown-arrow"},{default:t(()=>[e(s(Re))]),_:1})])]}),_:1})),c.value?(d(),v(T,{key:2,onCommand:$,placement:"bottom-end"},{dropdown:t(()=>[e(B,null,{default:t(()=>[e(g,{command:"profile"},{default:t(()=>[e(n,null,{default:t(()=>[e(s(M))]),_:1}),a[15]||(a[15]=p(" 个人资料 ",-1))]),_:1}),s(u).isAdmin?(d(),v(g,{key:0,command:"settings"},{default:t(()=>[e(n,null,{default:t(()=>[e(s(C))]),_:1}),a[16]||(a[16]=p(" 设置 ",-1))]),_:1})):m("",!0),e(g,{divided:"",command:"logout"},{default:t(()=>[e(n,null,{default:t(()=>[e(s(z))]),_:1}),a[17]||(a[17]=p(" 退出登录 ",-1))]),_:1})]),_:1})]),default:t(()=>[e(k,{type:"text",class:"mobile-user-btn"},{default:t(()=>{var i;return[e(A,{size:24,src:(i=s(u).user)==null?void 0:i.avatar_url},{default:t(()=>{var b,E;return[p(_((E=(b=s(u).user)==null?void 0:b.username)==null?void 0:E.charAt(0).toUpperCase()),1)]}),_:1},8,["src"])]}),_:1})]),_:1})):m("",!0)])]),o("main",rt,[e(ce,null,{default:t(({Component:i})=>[e(we,{name:"page-slide",mode:"out-in"},{default:t(()=>[i?(d(),h("div",dt,[(d(),v(ye(i)))])):m("",!0)]),_:2},1024)]),_:1})])],2),c.value?(d(),h("div",it,[o("div",ct,[o("div",{class:f(["nav-item",{active:l.$route.path==="/"}]),onClick:a[0]||(a[0]=i=>l.$router.push("/"))},[e(n,{class:"nav-icon"},{default:t(()=>[e(s(Z))]),_:1}),a[18]||(a[18]=o("span",{class:"nav-text"},"文件",-1))],2),o("div",{class:f(["nav-item",{active:l.$route.path==="/dashboard"}]),onClick:a[1]||(a[1]=i=>l.$router.push("/dashboard"))},[e(n,{class:"nav-icon"},{default:t(()=>[e(s(ee))]),_:1}),a[19]||(a[19]=o("span",{class:"nav-text"},"仪表盘",-1))],2),((j=s(u).user)==null?void 0:j.role)==="admin"?(d(),h("div",{key:0,class:f(["nav-item",{active:l.$route.path==="/admin"}]),onClick:a[2]||(a[2]=i=>l.$router.push("/admin"))},[e(n,{class:"nav-icon"},{default:t(()=>[e(s(C))]),_:1}),a[20]||(a[20]=o("span",{class:"nav-text"},"管理",-1))],2)):m("",!0),o("div",{class:f(["nav-item",{active:l.$route.path==="/profile"}]),onClick:a[3]||(a[3]=i=>l.$router.push("/profile"))},[e(n,{class:"nav-icon"},{default:t(()=>[e(s(M))]),_:1}),a[21]||(a[21]=o("span",{class:"nav-text"},"我的",-1))],2)])])):m("",!0)])}}}),xt=me(mt,[["__scopeId","data-v-e857f994"]]);export{xt as default};
