import{_ as oe}from"./_plugin-vue_export-helper-BwE83l92.js";/* empty css                */import"./el-form-item-l0sNRNKZ.js";/* empty css                 */import{y as te,c as ae,r as _,l as B,j as le,U as re,z as x,B as s,aB as ie,R as t,J as a,L as E,E as V,W as M,O as w,al as ne,A as g,u as l,I as N,P as k,a4 as de,aC as ue}from"./vendor-BcB6VvZI.js";import{b as pe,d as ce,v as me,o as T,e as ve,f as fe,c as we,r as j,g as R,l as b,t as D,w as _e,E as u}from"./element-CHj0RLGm.js";import{u as ge,a as P}from"./index-JAZUU9Ah.js";import{i as ye}from"./helpers-iwoUo1o7.js";const he={class:"forgot-password-container"},Ce={class:"top-nav"},Ee={class:"nav-content"},Ve={class:"nav-logo"},be={class:"forgot-password-content"},Pe={class:"forgot-password-box"},xe={class:"steps-indicator"},ke={key:0,class:"step-content"},Re={class:"step-header"},ze={class:"header-icon"},Fe={key:1,class:"step-content"},Se={class:"step-header"},Ie={class:"header-icon"},Ue={class:"email-code-group"},Be={class:"step-actions"},Me={key:2,class:"step-content"},Ne={class:"step-header"},Te={class:"header-icon"},Ae={class:"step-actions"},Ke={class:"forgot-password-footer"},We={class:"login-link"},$e={class:"info-panel"},je={class:"panel-content"},De={class:"instruction-list"},Je={class:"instruction-item"},Le={class:"instruction-item"},Oe={class:"instruction-item"},qe=te({__name:"ForgotPassword",setup(Ge){const J=ue();ge(),ae(()=>window.innerWidth<=768);const n=_(1),i=_(!1),z=_(),F=_(),S=_(),m=B({email:""}),p=B({username:"",emailCode:""}),v=B({newPassword:"",confirmPassword:""}),y=_(0),h=_(null),L=(r,e,o)=>{e?ye(e)?o():o(new Error("请输入有效的邮箱地址")):o(new Error("请输入邮箱地址"))},O=(r,e,o)=>{e?e.length<3?o(new Error("用户名长度不能少于3位")):o():o(new Error("请输入用户名"))},q=(r,e,o)=>{e?e.length!==6?o(new Error("验证码必须是6位数字")):/^\d{6}$/.test(e)?o():o(new Error("验证码只能包含数字")):o(new Error("请输入验证码"))},G=(r,e,o)=>{e?e.length<6?o(new Error("密码长度不能少于6位")):o():o(new Error("请输入新密码"))},H=(r,e,o)=>{e?e!==v.newPassword?o(new Error("两次输入的密码不一致")):o():o(new Error("请确认新密码"))},Q={email:[{validator:L,trigger:"blur"}]},X={username:[{validator:O,trigger:"blur"}],emailCode:[{validator:q,trigger:"blur"}]},Y={newPassword:[{validator:G,trigger:"blur"}],confirmPassword:[{validator:H,trigger:"blur"}]},A=async()=>{var r,e;if(z.value)try{await z.value.validate(),i.value=!0,(await P.post("/auth/check-email",{email:m.email})).data.exists?(n.value=2,u.success("邮箱验证成功，请继续下一步")):u.error("该邮箱地址未注册")}catch(o){console.error("邮箱验证失败:",o);const d=((e=(r=o.response)==null?void 0:r.data)==null?void 0:e.message)||"邮箱验证失败";u.error(d)}finally{i.value=!1}},Z=async()=>{var r,e;try{await P.post("/auth/send-email-code",{email:m.email,type:"forgot_password"}),u.success("验证码已发送到您的邮箱"),ee()}catch(o){console.error("发送验证码失败:",o);const d=((e=(r=o.response)==null?void 0:r.data)==null?void 0:e.message)||"发送验证码失败";u.error(d)}},ee=()=>{y.value=60,h.value=window.setInterval(()=>{y.value--,y.value<=0&&(clearInterval(h.value),h.value=null)},1e3)},K=async()=>{var r,e;if(F.value)try{await F.value.validate(),i.value=!0,(await P.post("/auth/verify-forgot-password",{username:p.username,email:m.email,emailCode:p.emailCode})).data.valid?(n.value=3,u.success("身份验证成功，请设置新密码")):u.error("用户名、邮箱或验证码不正确")}catch(o){console.error("身份验证失败:",o);const d=((e=(r=o.response)==null?void 0:r.data)==null?void 0:e.message)||"身份验证失败";u.error(d)}finally{i.value=!1}},I=async()=>{var r,e;if(S.value)try{if(await S.value.validate(),i.value=!0,(await P.post("/auth/check-password-same",{username:p.username,email:m.email,newPassword:v.newPassword})).data.isSame){u.error("新密码不能与原密码相同，请重新设置");return}(await P.post("/auth/reset-password-new",{username:p.username,email:m.email,emailCode:p.emailCode,newPassword:v.newPassword})).data.success&&(u.success({message:"密码重置成功！2秒后自动跳转到登录页面",duration:2e3,showClose:!1}),$(),setTimeout(()=>{J.push("/login")},2e3))}catch(o){console.error("密码重置失败:",o);const d=((e=(r=o.response)==null?void 0:r.data)==null?void 0:e.message)||"密码重置失败";u.error(d)}finally{i.value=!1}},W=()=>{n.value>1&&n.value--},$=()=>{h.value&&(clearInterval(h.value),h.value=null)};return le(()=>{}),re(()=>{$()}),(r,e)=>{const o=pe,d=fe,f=ve,C=we,U=ce,se=ne("router-link");return g(),x("div",he,[s("div",Ce,[s("div",Ee,[s("div",Ve,[t(o,{class:"logo-icon"},{default:a(()=>[t(l(me))]),_:1}),e[5]||(e[5]=s("span",{class:"logo-text"},"图库系统",-1))])])]),s("div",be,[s("div",Pe,[s("div",xe,[s("div",{class:V(["step-item",{active:n.value>=1,completed:n.value>1}])},[...e[6]||(e[6]=[s("div",{class:"step-number"},"1",-1),s("div",{class:"step-label"},"输入邮箱",-1)])],2),s("div",{class:V(["step-line",{active:n.value>1}])},null,2),s("div",{class:V(["step-item",{active:n.value>=2,completed:n.value>2}])},[...e[7]||(e[7]=[s("div",{class:"step-number"},"2",-1),s("div",{class:"step-label"},"验证身份",-1)])],2),s("div",{class:V(["step-line",{active:n.value>2}])},null,2),s("div",{class:V(["step-item",{active:n.value>=3}])},[...e[8]||(e[8]=[s("div",{class:"step-number"},"3",-1),s("div",{class:"step-label"},"重置密码",-1)])],2)]),n.value===1?(g(),x("div",ke,[s("div",Re,[s("div",ze,[t(o,null,{default:a(()=>[t(l(T))]),_:1})]),e[9]||(e[9]=s("h1",{class:"step-title"},"找回密码",-1)),e[10]||(e[10]=s("p",{class:"step-subtitle"},"输入您的邮箱地址，我们将发送验证码",-1))]),t(U,{ref_key:"emailFormRef",ref:z,model:m,rules:Q,class:"step-form",onSubmit:M(A,["prevent"])},{default:a(()=>[t(f,{prop:"email"},{default:a(()=>[t(d,{modelValue:m.email,"onUpdate:modelValue":e[0]||(e[0]=c=>m.email=c),placeholder:"请输入注册时的邮箱地址",size:"large","prefix-icon":l(T),clearable:"",class:"custom-input"},null,8,["modelValue","prefix-icon"])]),_:1}),t(f,null,{default:a(()=>[t(C,{type:"primary",size:"large",class:"step-button",loading:i.value,onClick:A},{default:a(()=>[i.value?E("",!0):(g(),N(o,{key:0},{default:a(()=>[t(l(j))]),_:1})),w(" "+k(i.value?"发送中...":"下一步"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])):E("",!0),n.value===2?(g(),x("div",Fe,[s("div",Se,[s("div",Ie,[t(o,null,{default:a(()=>[t(l(R))]),_:1})]),e[11]||(e[11]=s("h1",{class:"step-title"},"验证身份",-1)),e[12]||(e[12]=s("p",{class:"step-subtitle"},"请输入用户名和邮箱验证码",-1))]),t(U,{ref_key:"verifyFormRef",ref:F,model:p,rules:X,class:"step-form",onSubmit:M(K,["prevent"])},{default:a(()=>[t(f,{prop:"username"},{default:a(()=>[t(d,{modelValue:p.username,"onUpdate:modelValue":e[1]||(e[1]=c=>p.username=c),placeholder:"请输入用户名",size:"large","prefix-icon":l(R),clearable:"",class:"custom-input"},null,8,["modelValue","prefix-icon"])]),_:1}),t(f,{prop:"emailCode"},{default:a(()=>[s("div",Ue,[t(d,{modelValue:p.emailCode,"onUpdate:modelValue":e[2]||(e[2]=c=>p.emailCode=c),placeholder:"请输入6位验证码",size:"large","prefix-icon":l(b),maxlength:"6",class:"custom-input code-input"},null,8,["modelValue","prefix-icon"]),t(C,{type:"primary",size:"large",disabled:y.value>0,onClick:Z,class:"send-code-btn"},{default:a(()=>[w(k(y.value>0?`${y.value}s`:"发送验证码"),1)]),_:1},8,["disabled"])])]),_:1}),t(f,null,{default:a(()=>[s("div",Be,[t(C,{size:"large",onClick:W},{default:a(()=>[t(o,null,{default:a(()=>[t(l(D))]),_:1}),e[13]||(e[13]=w(" 上一步 ",-1))]),_:1}),t(C,{type:"primary",size:"large",class:"step-button",loading:i.value,onClick:K},{default:a(()=>[i.value?E("",!0):(g(),N(o,{key:0},{default:a(()=>[t(l(j))]),_:1})),w(" "+k(i.value?"验证中...":"下一步"),1)]),_:1},8,["loading"])])]),_:1})]),_:1},8,["model"])])):E("",!0),n.value===3?(g(),x("div",Me,[s("div",Ne,[s("div",Te,[t(o,null,{default:a(()=>[t(l(b))]),_:1})]),e[14]||(e[14]=s("h1",{class:"step-title"},"重置密码",-1)),e[15]||(e[15]=s("p",{class:"step-subtitle"},"请输入您的新密码",-1))]),t(U,{ref_key:"passwordFormRef",ref:S,model:v,rules:Y,class:"step-form",onSubmit:M(I,["prevent"])},{default:a(()=>[t(f,{prop:"newPassword"},{default:a(()=>[t(d,{modelValue:v.newPassword,"onUpdate:modelValue":e[3]||(e[3]=c=>v.newPassword=c),type:"password",placeholder:"请输入新密码",size:"large","prefix-icon":l(b),"show-password":"",class:"custom-input"},null,8,["modelValue","prefix-icon"])]),_:1}),t(f,{prop:"confirmPassword"},{default:a(()=>[t(d,{modelValue:v.confirmPassword,"onUpdate:modelValue":e[4]||(e[4]=c=>v.confirmPassword=c),type:"password",placeholder:"请确认新密码",size:"large","prefix-icon":l(b),"show-password":"",class:"custom-input",onKeyup:de(I,["enter"])},null,8,["modelValue","prefix-icon"])]),_:1}),t(f,null,{default:a(()=>[s("div",Ae,[t(C,{size:"large",onClick:W},{default:a(()=>[t(o,null,{default:a(()=>[t(l(D))]),_:1}),e[16]||(e[16]=w(" 上一步 ",-1))]),_:1}),t(C,{type:"primary",size:"large",class:"step-button",loading:i.value,onClick:I},{default:a(()=>[i.value?E("",!0):(g(),N(o,{key:0},{default:a(()=>[t(l(_e))]),_:1})),w(" "+k(i.value?"重置中...":"完成重置"),1)]),_:1},8,["loading"])])]),_:1})]),_:1},8,["model"])])):E("",!0),s("div",Ke,[s("p",We,[e[18]||(e[18]=w(" 记起密码了？ ",-1)),t(se,{to:"/login",class:"link"},{default:a(()=>[t(o,null,{default:a(()=>[t(l(R))]),_:1}),e[17]||(e[17]=w(" 返回登录 ",-1))]),_:1})])])]),s("div",$e,[s("div",je,[e[22]||(e[22]=s("h2",{class:"panel-title"},"密码重置说明",-1)),s("div",De,[s("div",Je,[t(o,{class:"instruction-icon"},{default:a(()=>[t(l(T))]),_:1}),e[19]||(e[19]=s("div",{class:"instruction-content"},[s("h3",null,"邮箱验证"),s("p",null,"验证码将发送到您注册时使用的邮箱地址")],-1))]),s("div",Le,[t(o,{class:"instruction-icon"},{default:a(()=>[t(l(R))]),_:1}),e[20]||(e[20]=s("div",{class:"instruction-content"},[s("h3",null,"身份确认"),s("p",null,"用户名和邮箱必须属于同一个账户")],-1))]),s("div",Oe,[t(o,{class:"instruction-icon"},{default:a(()=>[t(l(b))]),_:1}),e[21]||(e[21]=s("div",{class:"instruction-content"},[s("h3",null,"密码安全"),s("p",null,"新密码不能与原密码相同，长度至少6位")],-1))])])])])]),e[23]||(e[23]=ie('<div class="bg-decoration" data-v-d801ad54><div class="floating-shape shape-1" data-v-d801ad54></div><div class="floating-shape shape-2" data-v-d801ad54></div><div class="floating-shape shape-3" data-v-d801ad54></div><div class="floating-shape shape-4" data-v-d801ad54></div></div>',1))])}}}),ts=oe(qe,[["__scopeId","data-v-d801ad54"]]);export{ts as default};
