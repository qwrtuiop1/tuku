import{_ as fe}from"./_plugin-vue_export-helper-BwE83l92.js";/* empty css                  *//* empty css                    *//* empty css                           *//* empty css                         *//* empty css                     *//* empty css                  *//* empty css                     */import{y as _e,r as y,c as ee,aD as ge,w as he,j as be,U as we,z as h,L as m,B as n,I as p,J as t,R as e,E as f,u as s,P as _,al as ye,A as d,O as v,Q as ke,a6 as Ee,T as Ce,M as Se,aC as Me}from"./vendor-BcB6VvZI.js";import{u as xe,a as Le}from"./index-z_UOtP8j.js";import{F as Ue,G as $e,H as Ae,I as Be,J as Te,K as ze,b as Xe,c as De,L as Ie,M as Ne,q as te,N as ae,O as C,g as S,P as Re,Q as Ve,R as Ye,S as X,T as Pe,U as Fe,V as qe,W as Je,E as Oe}from"./element-CCVRQ6po.js";import{f as se,b as Qe,g as We}from"./helpers-Bt27ni5u.js";const je="/logo.png",Ge={class:"main-layout"},He={class:"sidebar-header"},Ke={key:0,class:"logo-text"},Ze={class:"sidebar-nav"},et={key:0,class:"user-details"},tt={class:"username"},at={class:"user-role"},st={class:"top-header"},ot={class:"header-left"},nt={class:"header-right"},lt={class:"storage-text"},ut={key:0,class:"mobile-storage"},rt={class:"desktop-user-info"},dt={class:"user-details"},it={class:"username"},ct={class:"user-role"},mt={class:"page-content"},vt={key:0,class:"page-wrapper"},pt={key:1,class:"mobile-bottom-nav"},ft={class:"nav-items"},_t=_e({__name:"MainLayout",setup(gt){const M=ge(),U=Me(),u=xe(),r=y(!1),c=y(!1),x=y(0),D=y(0),L=y(!1);y(!1);const $=y(!0),I=()=>{const o=window.innerWidth;c.value=o<768,o<768||o<1024?r.value=!0:r.value=!1},oe=ee(()=>M.path),ne=ee(()=>{const o={"/":{name:"文件管理",path:"/"},"/dashboard":{name:"仪表盘",path:"/dashboard"},"/admin":{name:"管理控制台",path:"/admin"},"/profile":{name:"个人资料",path:"/profile"},"/settings":{name:"系统设置",path:"/settings"},"/user-center":{name:"个人设置",path:"/user-center"}};return o[M.path]?[o[M.path]]:[]}),N=()=>{r.value=!r.value},le=()=>{r.value&&(r.value=!1)},ue=()=>{c.value&&(r.value=!0)},R=o=>We(o),re=()=>{c.value&&(r.value=!0)},A=async o=>{switch(o){case"profile":U.push("/profile");break;case"settings":u.isAdmin?U.push("/settings"):Oe.warning("需要管理员权限");break;case"logout":try{await Je.confirm("确定要退出登录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),u.logout(),U.push("/login")}catch{}break}},V=o=>{c.value&&(x.value=o.touches[0].clientX,D.value=o.touches[0].clientY,L.value=!1)},Y=o=>{if(!c.value)return;const a=o.touches[0].clientX,l=o.touches[0].clientY,w=a-x.value,k=l-D.value;Math.abs(w)>Math.abs(k)&&Math.abs(w)>10&&(L.value=!0)},P=o=>{if(!c.value||!L.value)return;const l=o.changedTouches[0].clientX-x.value;l>50&&x.value<20?r.value=!1:l<-50&&r.value===!1&&(r.value=!0),L.value=!1};he(M,()=>{},{immediate:!0});const F=()=>{I()},de=async()=>{var o;try{const l=(await Le.get("/admin/settings")).data.settings||{};$.value=((o=l.enable_animation)==null?void 0:o.value)!=="false"}catch{console.warn("获取系统设置失败，使用默认动画设置")}},q=o=>{const a=o.detail;a.enable_animation!==void 0&&($.value=a.enable_animation)};return be(()=>{I(),window.addEventListener("resize",F),c.value&&(document.addEventListener("touchstart",V,{passive:!0}),document.addEventListener("touchmove",Y,{passive:!0}),document.addEventListener("touchend",P,{passive:!0})),de(),window.addEventListener("system-settings-changed",q)}),we(()=>{window.removeEventListener("resize",F),window.removeEventListener("system-settings-changed",q),c.value&&(document.removeEventListener("touchstart",V),document.removeEventListener("touchmove",Y),document.removeEventListener("touchend",P))}),(o,a)=>{var O,Q,W,j,G,H;const l=Xe,w=De,k=Ne,ie=Ue,B=$e,g=Ye,T=Ve,z=Ae,ce=Fe,me=Be,J=Te,ve=ze,pe=ye("router-view");return d(),h("div",Ge,[c.value&&!r.value?(d(),h("div",{key:0,class:"mobile-overlay",onClick:ue})):m("",!0),n("aside",{class:f(["sidebar",{collapsed:r.value,"mobile-sidebar":c.value,"mobile-open":c.value&&!r.value}])},[n("div",He,[n("div",{class:"logo",onClick:le},[a[4]||(a[4]=n("img",{src:je,alt:"图库系统",class:"logo-image"},null,-1)),r.value?m("",!0):(d(),h("span",Ke,"图库系统"))]),r.value?m("",!0):(d(),p(w,{key:0,type:"text",class:"collapse-btn",onClick:N},{default:t(()=>[e(l,null,{default:t(()=>[e(s(Ie))]),_:1})]),_:1}))]),n("nav",Ze,[e(ie,{"default-active":oe.value,collapse:r.value,"unique-opened":!0,router:"",onSelect:re},{default:t(()=>[e(k,{index:"/"},{default:t(()=>[e(l,null,{default:t(()=>[e(s(te))]),_:1}),a[5]||(a[5]=n("span",null,"文件管理",-1))]),_:1}),e(k,{index:"/dashboard"},{default:t(()=>[e(l,null,{default:t(()=>[e(s(ae))]),_:1}),a[6]||(a[6]=n("span",null,"仪表盘",-1))]),_:1}),s(u).isAdmin?(d(),p(k,{key:0,index:"/admin"},{default:t(()=>[e(l,null,{default:t(()=>[e(s(C))]),_:1}),a[7]||(a[7]=n("span",null,"管理中心",-1))]),_:1})):m("",!0),s(u).isAdmin?m("",!0):(d(),p(k,{key:1,index:"/user-center"},{default:t(()=>[e(l,null,{default:t(()=>[e(s(S))]),_:1}),a[8]||(a[8]=n("span",null,"个人设置",-1))]),_:1}))]),_:1},8,["default-active","collapse"])]),n("div",{class:f(["sidebar-footer",{collapsed:r.value}])},[n("div",{class:f(["user-info",{collapsed:r.value}])},[e(B,{size:32,src:(O=s(u).user)==null?void 0:O.avatar_url},{default:t(()=>{var i,b;return[v(_((b=(i=s(u).user)==null?void 0:i.username)==null?void 0:b.charAt(0).toUpperCase()),1)]}),_:1},8,["src"]),r.value?m("",!0):(d(),h("div",et,[n("div",tt,_((Q=s(u).user)==null?void 0:Q.username),1),n("div",at,_(((W=s(u).user)==null?void 0:W.role)==="admin"?"管理员":"用户"),1)]))],2),e(z,{onCommand:A,placement:"top-end"},{dropdown:t(()=>[e(T,null,{default:t(()=>[e(g,{command:"profile"},{default:t(()=>[e(l,null,{default:t(()=>[e(s(S))]),_:1}),a[9]||(a[9]=v(" 个人资料 ",-1))]),_:1}),s(u).isAdmin?(d(),p(g,{key:0,command:"settings"},{default:t(()=>[e(l,null,{default:t(()=>[e(s(C))]),_:1}),a[10]||(a[10]=v(" 设置 ",-1))]),_:1})):m("",!0),e(g,{divided:"",command:"logout"},{default:t(()=>[e(l,null,{default:t(()=>[e(s(X))]),_:1}),a[11]||(a[11]=v(" 退出登录 ",-1))]),_:1})]),_:1})]),default:t(()=>[e(w,{type:"text",class:f(["user-menu-btn",{collapsed:r.value}])},{default:t(()=>[e(l,null,{default:t(()=>[e(s(Re))]),_:1})]),_:1},8,["class"])]),_:1})],2)],2),n("div",{class:f(["main-content",{"sidebar-collapsed":r.value}])},[n("header",st,[n("div",ot,[c.value?(d(),p(w,{key:0,type:"text",class:"mobile-menu-btn",onClick:N},{default:t(()=>[e(l,null,{default:t(()=>[e(s(Pe))]),_:1})]),_:1})):m("",!0),e(me,{separator:"/",class:"breadcrumb-nav"},{default:t(()=>[(d(!0),h(ke,null,Ee(ne.value,i=>(d(),p(ce,{key:i.path,to:i.path},{default:t(()=>[v(_(i.name),1)]),_:2},1032,["to"]))),128))]),_:1})]),n("div",nt,[n("div",{class:f(["storage-info",{"mobile-hidden":c.value}])},[e(J,{percentage:s(u).storageUsage,color:R(s(u).storageUsage),"stroke-width":6,"show-text":!1,class:"storage-progress"},null,8,["percentage","color"]),n("span",lt,_(s(se)(((j=s(u).user)==null?void 0:j.used_storage)||0))+" / "+_(s(se)(((G=s(u).user)==null?void 0:G.storage_limit)||0)),1)],2),c.value?(d(),h("div",ut,[e(ve,{content:`存储使用: ${s(Qe)(s(u).storageUsage)}`,placement:"bottom"},{default:t(()=>[e(J,{percentage:s(u).storageUsage,color:R(s(u).storageUsage),"stroke-width":12,"show-text":!1,class:"mobile-storage-progress"},null,8,["percentage","color"])]),_:1},8,["content"])])):m("",!0),c.value?m("",!0):(d(),p(z,{key:1,onCommand:A,placement:"bottom-end"},{dropdown:t(()=>[e(T,null,{default:t(()=>[e(g,{command:"profile"},{default:t(()=>[e(l,null,{default:t(()=>[e(s(S))]),_:1}),a[12]||(a[12]=v(" 个人资料 ",-1))]),_:1}),s(u).isAdmin?(d(),p(g,{key:0,command:"settings"},{default:t(()=>[e(l,null,{default:t(()=>[e(s(C))]),_:1}),a[13]||(a[13]=v(" 设置 ",-1))]),_:1})):m("",!0),e(g,{divided:"",command:"logout"},{default:t(()=>[e(l,null,{default:t(()=>[e(s(X))]),_:1}),a[14]||(a[14]=v(" 退出登录 ",-1))]),_:1})]),_:1})]),default:t(()=>{var i,b,E;return[n("div",rt,[e(B,{size:32,src:(i=s(u).user)==null?void 0:i.avatar_url},{default:t(()=>{var K,Z;return[v(_((Z=(K=s(u).user)==null?void 0:K.username)==null?void 0:Z.charAt(0).toUpperCase()),1)]}),_:1},8,["src"]),n("div",dt,[n("div",it,_((b=s(u).user)==null?void 0:b.username),1),n("div",ct,_(((E=s(u).user)==null?void 0:E.role)==="admin"?"管理员":"用户"),1)]),e(l,{class:"dropdown-arrow"},{default:t(()=>[e(s(qe))]),_:1})])]}),_:1})),c.value?(d(),p(z,{key:2,onCommand:A,placement:"bottom-end"},{dropdown:t(()=>[e(T,null,{default:t(()=>[e(g,{command:"profile"},{default:t(()=>[e(l,null,{default:t(()=>[e(s(S))]),_:1}),a[15]||(a[15]=v(" 个人资料 ",-1))]),_:1}),s(u).isAdmin?(d(),p(g,{key:0,command:"settings"},{default:t(()=>[e(l,null,{default:t(()=>[e(s(C))]),_:1}),a[16]||(a[16]=v(" 设置 ",-1))]),_:1})):m("",!0),e(g,{divided:"",command:"logout"},{default:t(()=>[e(l,null,{default:t(()=>[e(s(X))]),_:1}),a[17]||(a[17]=v(" 退出登录 ",-1))]),_:1})]),_:1})]),default:t(()=>[e(w,{type:"text",class:"mobile-user-btn"},{default:t(()=>{var i;return[e(B,{size:24,src:(i=s(u).user)==null?void 0:i.avatar_url},{default:t(()=>{var b,E;return[v(_((E=(b=s(u).user)==null?void 0:b.username)==null?void 0:E.charAt(0).toUpperCase()),1)]}),_:1},8,["src"])]}),_:1})]),_:1})):m("",!0)])]),n("main",mt,[e(pe,null,{default:t(({Component:i})=>[e(Ce,{name:"page-slide",mode:"out-in",duration:$.value?300:0},{default:t(()=>[i?(d(),h("div",vt,[(d(),p(Se(i)))])):m("",!0)]),_:2},1032,["duration"])]),_:1})])],2),c.value?(d(),h("div",pt,[n("div",ft,[n("div",{class:f(["nav-item",{active:o.$route.path==="/"}]),onClick:a[0]||(a[0]=i=>o.$router.push("/"))},[e(l,{class:"nav-icon"},{default:t(()=>[e(s(te))]),_:1}),a[18]||(a[18]=n("span",{class:"nav-text"},"文件",-1))],2),n("div",{class:f(["nav-item",{active:o.$route.path==="/dashboard"}]),onClick:a[1]||(a[1]=i=>o.$router.push("/dashboard"))},[e(l,{class:"nav-icon"},{default:t(()=>[e(s(ae))]),_:1}),a[19]||(a[19]=n("span",{class:"nav-text"},"仪表盘",-1))],2),((H=s(u).user)==null?void 0:H.role)==="admin"?(d(),h("div",{key:0,class:f(["nav-item",{active:o.$route.path==="/admin"}]),onClick:a[2]||(a[2]=i=>o.$router.push("/admin"))},[e(l,{class:"nav-icon"},{default:t(()=>[e(s(C))]),_:1}),a[20]||(a[20]=n("span",{class:"nav-text"},"管理",-1))],2)):m("",!0),n("div",{class:f(["nav-item",{active:o.$route.path==="/profile"}]),onClick:a[3]||(a[3]=i=>o.$router.push("/profile"))},[e(l,{class:"nav-icon"},{default:t(()=>[e(s(S))]),_:1}),a[21]||(a[21]=n("span",{class:"nav-text"},"我的",-1))],2)])])):m("",!0)])}}}),$t=fe(_t,[["__scopeId","data-v-c5eebeeb"]]);export{$t as default};
